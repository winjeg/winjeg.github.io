<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>winjeg&#039;s blog</title><meta description="none"><meta property="og:type" content="blog"><meta property="og:title" content="winjeg&#039;s blog"><meta property="og:url" content="https://winjeg.github.io/"><meta property="og:site_name" content="winjeg&#039;s blog"><meta property="og:description" content="none"><meta property="og:image" content="https://winjeg.github.io/img/og_image.png"><meta property="article:author" content="winjeg"><meta property="article:tag" content="golang"><meta property="article:tag" content=" java"><meta property="article:tag" content=" mysql"><meta property="article:tag" content=" devops"><meta property="article:tag" content=" linux"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://winjeg.github.io"},"headline":"winjeg's blog","image":["https://winjeg.github.io/img/og_image.png"],"author":{"@type":"Person","name":"winjeg"},"description":"none"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="winjeg&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-11-13T07:14:11.000Z" title="2018-11-13T07:14:11.000Z">2018-11-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">18 minutes lesen (Über 2655 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/11/13/storage/redis/mem_analysis/">redis 内存分析工具 `rma4go`</a></h1><div class="content"><h2 id="redis-简介"><a href="#redis-简介" class="headerlink" title="redis 简介"></a>redis 简介</h2><p>redis是一个很有名的内存型数据库，这里不做详细介绍。而<code>rma4go</code> (redis memory analyzer for golang) 是一个redis的内存分析工具，这个工具的主要作用是针对运行时期的redis进行内存的分析，统计redis中key的分布情况， 各种数据类型的使用情况，key的size，大key的数量及分布, key的过期状况分布等一些有助于定位redis使用问题的工具，希望这能够给应用开发者提供便利排查生产中所遇到的实际问题。</p>
<h2 id="rma4go的应用场景"><a href="#rma4go的应用场景" class="headerlink" title="rma4go的应用场景"></a><code>rma4go</code>的应用场景</h2><p>redis是目前很流行的一个内存型数据库，很多企业都在使用。 但由于业界并没有很多对于redis使用上的规范，或者是有一些规范并没有被很好的遵循， 存在很多redis使用上的问题，我这边就列举一些例子：</p>
<ol>
<li>redis 存用满了, 不知道key的分布情况，不知道来源于那个应用</li>
<li>redis 被block了，不知道什么原因导致的block，是哪个应用里的什么key的操作导致的</li>
<li>想迁移redis数据，或者调整一些设置，但不知道要不要对redis里的数据进行保留，以及不知道什么业务在使用等</li>
<li>redis的key的过期情况不明朗， 不知道哪些东西可以删除或者调整<br>其实上面的一些问题是我随便列举出来的一些，并不是所有的存在的问题，相信也有很多其他场景同样会用到这样的一个redis内存分析工具<code>rma4go</code></li>
</ol>
<h2 id="rma4go的具体功能"><a href="#rma4go的具体功能" class="headerlink" title="rma4go的具体功能"></a>rma4go的具体功能</h2><h3 id="数据维度"><a href="#数据维度" class="headerlink" title="数据维度"></a>数据维度</h3><p>对于key的分析我们这个工具会提供如下几个维度的数据：</p>
<ul>
<li>key的数量分布维度</li>
<li>key的过期分布维度</li>
<li>key的类型分布维度</li>
<li>key对应的的数据的大小分布维度</li>
<li>key的前缀分布维度</li>
<li>慢key与大key的维度</li>
</ul>
<p>当然以后如果发现有更好的纬度也会添加进去，目前先以这几个纬度为主</p>
<h3 id="数据类型设计"><a href="#数据类型设计" class="headerlink" title="数据类型设计"></a>数据类型设计</h3><figure class="highlight go hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">type</span> RedisStat <span class="hljs-keyword">struct</span> &#123;</span><br><span class="line">	All     KeyStat <span class="hljs-string">`json:"all"`</span></span><br><span class="line">	String  KeyStat <span class="hljs-string">`json:"string"`</span></span><br><span class="line">	Hash    KeyStat <span class="hljs-string">`json:"hash"`</span></span><br><span class="line">	Set     KeyStat <span class="hljs-string">`json:"set"`</span></span><br><span class="line">	List    KeyStat <span class="hljs-string">`json:"list"`</span></span><br><span class="line">	ZSet    KeyStat <span class="hljs-string">`json:"zset"`</span></span><br><span class="line">	Other   KeyStat <span class="hljs-string">`json:"other"`</span></span><br><span class="line">	BigKeys KeyStat <span class="hljs-string">`json:"bigKeys"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// distributions of keys of all prefixes</span></span><br><span class="line"><span class="hljs-keyword">type</span> Distribution <span class="hljs-keyword">struct</span> &#123;</span><br><span class="line">	KeyPattern <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"pattern"`</span></span><br><span class="line">	Metrics</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// basic metrics of a group of key</span></span><br><span class="line"><span class="hljs-keyword">type</span> Metrics <span class="hljs-keyword">struct</span> &#123;</span><br><span class="line">	KeyCount       <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"keyCount"`</span></span><br><span class="line">	KeySize        <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"keySize"`</span></span><br><span class="line">	DataSize       <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"dataSize"`</span></span><br><span class="line">	KeyNeverExpire <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"neverExpire"`</span></span><br><span class="line">	ExpireInHour   <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"expireInHour"`</span>  <span class="hljs-comment">// &gt;= 0h &lt; 1h</span></span><br><span class="line">	ExpireInDay    <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"expireInDay"`</span>   <span class="hljs-comment">// &gt;= 1h &lt; 24h</span></span><br><span class="line">	ExpireInWeek   <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"expireInWeek"`</span>  <span class="hljs-comment">// &gt;= 1d &lt; 7d</span></span><br><span class="line">	ExpireOutWeek  <span class="hljs-keyword">int64</span> <span class="hljs-string">`json:"expireOutWeek"`</span> <span class="hljs-comment">// &gt;= 7d</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h3><h4 id="key元信息"><a href="#key元信息" class="headerlink" title="key元信息"></a>key元信息</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type KeyMeta struct &#123;</span><br><span class="line">	Key      string</span><br><span class="line">	KeySize  int64</span><br><span class="line">	DataSize int64</span><br><span class="line">	Ttl      int64</span><br><span class="line">	Type     string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>众所周知， redis里的所有的数据基本都是由key的， 也是根据key进行操作的，那么对redis里的key进行分析我们必须要记录下来这个key的信息才可以做到， 我们能记录的信息正如以上结构中的一样， key本身， key的大小， 数据的大小， 过期时间以及key的类型。这些信息是我们对key进行分析的一个基础信息，都可以通过一些简单的redis命令就可以取到。</p>
<h4 id="遍历redis所有key"><a href="#遍历redis所有key" class="headerlink" title="遍历redis所有key"></a>遍历redis所有key</h4><p>要对一个redis进行完整的key分析， 我们就需要有办法能够访问到所有key的源信息， 所幸redis提供了 <code>scan</code>这么一种方式可以比较轻量的遍历所有的key，访问到相应的key的元信息。<br>这样对于redis而言， 进行在线key分析的时候造成的压力也不会非常大，当然key分析不能再QPS高峰期进行， 需要在redis资源余量允许的情况下进行分析。</p>
<p>另外由于redis本身的一个内存清理机制，有25%的过期占用可以在分析key的时候被清理掉， 因此这个分析工具同时兼具了清理一部分内存的作用， 如果redis里面存在过期的而且存在于内存里面的key的话。</p>
<h4 id="对记录的信息进行分析与汇总"><a href="#对记录的信息进行分析与汇总" class="headerlink" title="对记录的信息进行分析与汇总"></a>对记录的信息进行分析与汇总</h4><p>有了遍历所有key的方法， 又有了元数据， 剩下的事情就是把这些数据进行聚合汇总， 这个主要是一个算法上的工作，<br>最难的部分要数这个key聚合的部分了， 这里面有很多取舍， 由于作者我本人不是专攻算法的， 而且没有找到合适的库， 因此只能动手自己想了一种方式。 基本的思路是：</p>
<h5 id="压缩的算法"><a href="#压缩的算法" class="headerlink" title="压缩的算法"></a>压缩的算法</h5><ol>
<li>对于每个新的key的元信息， 添加到老的key分析对象里去</li>
<li>对这个key从后往前缩短， 去除尾部，看是否已经包含这个key的统计信息，如果包含， 则把key的信息累加上去， 如果不包含则创建一个新的纪录。</li>
<li>当记录的个数添加到一定数量的时候， 对对象的个数进行一次压缩<ul>
<li>压缩的算法也是从字符串的末尾往字符串首部进行压缩</li>
<li>当压缩不能增加这个pattern 的key的个数的时候使用原来的key（压缩前的key）</li>
<li>当压缩可以增加这个pattern的key的个数的时候，进行key的合并，把pattern设置成压缩后的pattern</li>
<li>当记录的条数超过指定的条数就循环往复，直到压缩到小于指定的条数为止</li>
<li>如果对于key的最小长度（就算再压缩也要保留一两位）有要求， 有一些压缩到字符串的最小长度的参数可以进行调整与设置， 进行一定的取舍。</li>
</ul>
</li>
<li>直到scan完毕</li>
</ol>
<h5 id="代码如下"><a href="#代码如下" class="headerlink" title="代码如下"></a>代码如下</h5><figure class="highlight go hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> (</span><br><span class="line">	defaultSize = <span class="hljs-number">128</span></span><br><span class="line">	compactNum  = <span class="hljs-number">30</span></span><br><span class="line">	maxLeftNum =  <span class="hljs-number">150</span></span><br><span class="line">	minKeyLenLower = <span class="hljs-number">2</span></span><br><span class="line">	minKeyLen   = <span class="hljs-number">5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(stat *KeyStat)</span> <span class="hljs-title">compact</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">	distMap := stat.Distribution</span><br><span class="line">	tmpMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>][]<span class="hljs-keyword">string</span>, defaultSize)</span><br><span class="line">	shrinkTo := compactNum</span><br><span class="line">	<span class="hljs-keyword">for</span> k := <span class="hljs-keyword">range</span> distMap &#123;</span><br><span class="line">		compactedKey := k</span><br><span class="line">		<span class="hljs-keyword">if</span> orgks, ok := tmpMap[compactedKey]; ok &#123;</span><br><span class="line">			orgks = <span class="hljs-built_in">append</span>(orgks, k)</span><br><span class="line">			tmpMap[compactedKey] = orgks</span><br><span class="line">		&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">			ks := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>, defaultSize)</span><br><span class="line">			ks = <span class="hljs-built_in">append</span>(ks, k)</span><br><span class="line">			tmpMap[compactedKey] = ks</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	shrinkTo--</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-built_in">len</span>(tmpMap) &gt; compactNum &amp;&amp; shrinkTo &gt;= minKeyLen) || (<span class="hljs-built_in">len</span>(tmpMap) &gt; maxLeftNum &amp;&amp; shrinkTo &gt;= minKeyLenLower) &#123;</span><br><span class="line">		tnMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>][]<span class="hljs-keyword">string</span>, defaultSize)</span><br><span class="line">		<span class="hljs-keyword">for</span> k := <span class="hljs-keyword">range</span> tmpMap &#123;</span><br><span class="line">			<span class="hljs-comment">// shrink</span></span><br><span class="line">			<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(k) &gt; shrinkTo &#123;</span><br><span class="line">				compactedKey := k[<span class="hljs-number">0</span>:shrinkTo]</span><br><span class="line">				<span class="hljs-keyword">if</span> oik, ok := tnMap[compactedKey]; ok &#123;</span><br><span class="line">					oik = <span class="hljs-built_in">append</span>(oik, tmpMap[k]...)</span><br><span class="line">					tnMap[compactedKey] = oik</span><br><span class="line"></span><br><span class="line">				&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">					ks := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>, defaultSize)</span><br><span class="line">					ks = <span class="hljs-built_in">append</span>(ks, tmpMap[k]...)</span><br><span class="line">					tnMap[compactedKey] = ks</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">				tnMap[k] = tmpMap[k]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">// 如果此次shrink 没有使得这个集合的元素数量增加， 就使用原来的key</span></span><br><span class="line">		<span class="hljs-keyword">for</span> k := <span class="hljs-keyword">range</span> tmpMap &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(k) &gt; shrinkTo &#123;</span><br><span class="line">				ck := k[<span class="hljs-number">0</span>:shrinkTo]</span><br><span class="line">				<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tnMap[ck]) == <span class="hljs-built_in">len</span>(tmpMap[k]) &amp;&amp; <span class="hljs-built_in">len</span>(tnMap[ck]) &gt; <span class="hljs-number">1</span> &#123;</span><br><span class="line">					x := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>, defaultSize)</span><br><span class="line">					tnMap[k] = <span class="hljs-built_in">append</span>(x, tnMap[ck]...)</span><br><span class="line">					<span class="hljs-built_in">delete</span>(tnMap, ck)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		tmpMap = tnMap</span><br><span class="line">		shrinkTo --</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dists := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]Distribution, defaultSize)</span><br><span class="line">	<span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> tmpMap &#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(v) &gt; <span class="hljs-number">1</span> &#123;</span><br><span class="line">			<span class="hljs-keyword">var</span> nd Distribution</span><br><span class="line">			<span class="hljs-keyword">for</span> _, dk := <span class="hljs-keyword">range</span> v &#123;</span><br><span class="line">				d := distMap[dk]</span><br><span class="line">				nd.KeyPattern = k + <span class="hljs-string">"*"</span></span><br><span class="line">				nd.KeyCount += d.KeyCount</span><br><span class="line">				nd.KeySize += d.KeySize</span><br><span class="line">				nd.DataSize += d.DataSize</span><br><span class="line">				nd.ExpireInHour += d.ExpireInHour</span><br><span class="line">				nd.ExpireInWeek += d.ExpireInWeek</span><br><span class="line">				nd.ExpireInDay += d.ExpireInDay</span><br><span class="line">				nd.ExpireOutWeek += d.ExpireOutWeek</span><br><span class="line">				nd.KeyNeverExpire += d.KeyNeverExpire</span><br><span class="line">			&#125;</span><br><span class="line">			dists[k] = nd</span><br><span class="line">		&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">			<span class="hljs-keyword">for</span> _, dk := <span class="hljs-keyword">range</span> v &#123;</span><br><span class="line">				nd := distMap[dk]</span><br><span class="line">				nd.KeyPattern = dk + <span class="hljs-string">"*"</span></span><br><span class="line">				dists[dk] = nd</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	stat.Distribution = dists</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在线key分析的github项目"><a href="#在线key分析的github项目" class="headerlink" title="在线key分析的github项目"></a>在线key分析的github项目</h2><p><a href="https://github.com/winjeg/rma4go" target="_blank" rel="noopener">rma4go</a><br>这是一个我已经写好的项目， 它使用起来非常简单</p>
<h3 id="构建方法"><a href="#构建方法" class="headerlink" title="构建方法"></a>构建方法</h3><ol>
<li><p>构建之前请确保golang sdk 已经安装， 并且版本 &gt;=1.11.0</p>
</li>
<li><p>请确保已经具备翻墙的环境， 因为它要下载一些依赖，可能来自墙外<br>翻墙方法如下</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// linux/osx</span><br><span class="line"><span class="hljs-built_in">export</span> http_proxy=somehost:port</span><br><span class="line"><span class="hljs-built_in">export</span> https_proxy=somehost:port</span><br><span class="line">// windows</span><br><span class="line"><span class="hljs-built_in">set</span> http_proxy=somehost:port</span><br><span class="line"><span class="hljs-built_in">set</span> https_proxy=somehost:port</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:winjeg/rma4go.git</span><br><span class="line">cd rma4go</span><br><span class="line">go build .</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>用法如下：<code>rma4go -h</code></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rma4go usage:</span><br><span class="line">rma4go -r some_host -p 6379 -a password -d 0</span><br><span class="line">======================================================</span><br><span class="line">  -H string</span><br><span class="line">        address of a redis (default &quot;localhost&quot;)</span><br><span class="line">  -a string</span><br><span class="line">        password/auth of the redis</span><br><span class="line">  -d int</span><br><span class="line">        db of the redis to analyze</span><br><span class="line">  -h    help content</span><br><span class="line">  -p int</span><br><span class="line">        port of the redis (default 6379)</span><br><span class="line">  -r string</span><br><span class="line">        address of a redis (default &quot;localhost&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="示例输出"><a href="#示例输出" class="headerlink" title="示例输出"></a>示例输出</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">all keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">string keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">list keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">hash keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">set keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">zset keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">other keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">big keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br></pre></td></tr></table></figure>

<p>rendered by markdown<br>total count 4004</p>
<p>all keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>TOP_TEN_NEW_XXXXXXXX*</td>
<td>1</td>
<td>20</td>
<td>1529</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>XXXXXXXXXXXXXX_STATISTICS_MIGRATION_LIST*</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-root:*</td>
<td>23</td>
<td>272</td>
<td>299</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>23</td>
</tr>
<tr>
<td>DS_AXXXXXXXX_CORRECT*</td>
<td>2</td>
<td>45</td>
<td>46</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>time-2*</td>
<td>761</td>
<td>7528</td>
<td>9893</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>761</td>
</tr>
<tr>
<td>time-level:*</td>
<td>537</td>
<td>8461</td>
<td>6981</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>537</td>
</tr>
<tr>
<td>time-9*</td>
<td>102</td>
<td>901</td>
<td>1326</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>102</td>
</tr>
<tr>
<td>time-7*</td>
<td>153</td>
<td>1372</td>
<td>1989</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>153</td>
</tr>
<tr>
<td>DS_MAGIC_SUCC_2017-06-22*</td>
<td>1</td>
<td>24</td>
<td>415</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssss*</td>
<td>5</td>
<td>124</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>5</td>
</tr>
<tr>
<td>appoint_abcdefg_msgid*</td>
<td>1</td>
<td>21</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>BUSSINESSXXXXXXX_STATISTICS_NEED_CALC_RECENT*</td>
<td>1</td>
<td>44</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>switch_abcd_abcde*</td>
<td>3</td>
<td>69</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>abcdeferCounter_201*</td>
<td>3</td>
<td>78</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>diy1234567flag*</td>
<td>1</td>
<td>14</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>DS_PRXXBCD_LIST*</td>
<td>1</td>
<td>15</td>
<td>17208</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-4*</td>
<td>133</td>
<td>1194</td>
<td>1729</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>133</td>
</tr>
<tr>
<td>datastatistics_switch_version0*</td>
<td>1</td>
<td>30</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>register_count_2_201*</td>
<td>592</td>
<td>15984</td>
<td>640</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>592</td>
</tr>
<tr>
<td>canVisitNewabcdef1234PageLevels*</td>
<td>1</td>
<td>31</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>YOUR_WEEK_VITALITY_INFO*</td>
<td>1</td>
<td>23</td>
<td>75782</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-8*</td>
<td>101</td>
<td>894</td>
<td>1313</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>101</td>
</tr>
<tr>
<td>EXPERTS_APPOINT_INFO_MAP*</td>
<td>1</td>
<td>24</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-3*</td>
<td>130</td>
<td>1215</td>
<td>1690</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>130</td>
</tr>
<tr>
<td>time-1*</td>
<td>943</td>
<td>9456</td>
<td>12259</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>943</td>
</tr>
<tr>
<td>time-64*</td>
<td>87</td>
<td>781</td>
<td>1131</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>87</td>
</tr>
<tr>
<td>time-5*</td>
<td>168</td>
<td>1516</td>
<td>2184</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>168</td>
</tr>
<tr>
<td>total</td>
<td>4004</td>
<td>53422</td>
<td>7832490</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4004</td>
</tr>
</tbody></table>
<p>string keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>BUSSINESSXXXXXXX_STATISTICS_NEED_CALC_RECENT*</td>
<td>1</td>
<td>44</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-5*</td>
<td>130</td>
<td>1174</td>
<td>1690</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>130</td>
</tr>
<tr>
<td>datastatistics_switch_version0*</td>
<td>1</td>
<td>30</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-7*</td>
<td>39</td>
<td>348</td>
<td>507</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>39</td>
</tr>
<tr>
<td>time-level:*</td>
<td>567</td>
<td>8939</td>
<td>7371</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>567</td>
</tr>
<tr>
<td>diy1234567flag*</td>
<td>1</td>
<td>14</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>switch_abcd_abcde*</td>
<td>3</td>
<td>69</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>time-2*</td>
<td>598</td>
<td>5918</td>
<td>7774</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>598</td>
</tr>
<tr>
<td>time-6*</td>
<td>125</td>
<td>1118</td>
<td>1625</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>125</td>
</tr>
<tr>
<td>time-4*</td>
<td>136</td>
<td>1225</td>
<td>1768</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>136</td>
</tr>
<tr>
<td>time-8*</td>
<td>72</td>
<td>636</td>
<td>936</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>72</td>
</tr>
<tr>
<td>time-1*</td>
<td>1176</td>
<td>11814</td>
<td>15288</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1176</td>
</tr>
<tr>
<td>time-9*</td>
<td>100</td>
<td>880</td>
<td>1300</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>100</td>
</tr>
<tr>
<td>time-root:*</td>
<td>23</td>
<td>272</td>
<td>299</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>23</td>
</tr>
<tr>
<td>register_count_2_201*</td>
<td>592</td>
<td>15984</td>
<td>640</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>592</td>
</tr>
<tr>
<td>DS_AXXXXXXXX_CORRECT*</td>
<td>1</td>
<td>20</td>
<td>20</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>TOP_TEN_NEW_tersssss*</td>
<td>1</td>
<td>20</td>
<td>1529</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-3*</td>
<td>202</td>
<td>1925</td>
<td>2626</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>202</td>
</tr>
<tr>
<td>total</td>
<td>3989</td>
<td>53042</td>
<td>46253</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3989</td>
</tr>
</tbody></table>
<p>list keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>XXXXXXXXXXXXXX_STATISTICS_MIGRATION_LIST*</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>DS_MAGIC_SUCC_2017-06-22*</td>
<td>1</td>
<td>24</td>
<td>415</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>DS_PRXXBCD_LIST*</td>
<td>1</td>
<td>15</td>
<td>17208</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>3</td>
<td>79</td>
<td>7710455</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
</tbody></table>
<p>hash keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>tersssss_action_prepage_new*</td>
<td>1</td>
<td>27</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>YOUR_WEEK_VITALITY_INFO*</td>
<td>1</td>
<td>23</td>
<td>75782</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>EXPERTS_APPOINT_INFO_MAP*</td>
<td>1</td>
<td>24</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>abcdeferCounter_2017-06-11*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssssHardTaskCounter*</td>
<td>1</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>abcdeferCounter_2018-04-27*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>abcdeferCounter_2017-09-01*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssssEasyTaskCounter*</td>
<td>1</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>8</td>
<td>198</td>
<td>75782</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>8</td>
</tr>
</tbody></table>
<p>set keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>tersssss_bind_phone_phone*</td>
<td>1</td>
<td>25</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>appoint_abcdefg_msgid*</td>
<td>1</td>
<td>21</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>canVisitNewabcdef1234PageLevels*</td>
<td>1</td>
<td>31</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssss_bind_phone_userid*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>4</td>
<td>103</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4</td>
</tr>
</tbody></table>
<p>zset keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>other keys statistics</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<p>big keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>XXXXXXXXXXXXXX_STATISTICS_MIGRATION_LIST*</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<h3 id="作为依赖使用"><a href="#作为依赖使用" class="headerlink" title="作为依赖使用"></a>作为依赖使用</h3><p>获取方法如下：</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/winjeg/rma4go</span><br></pre></td></tr></table></figure>

<p>使用方法如下：</p>
<figure class="highlight go hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testFunc</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">	h := <span class="hljs-string">"localhost"</span></span><br><span class="line">	a := <span class="hljs-string">""</span></span><br><span class="line">	p := <span class="hljs-number">6379</span></span><br><span class="line">	cli := client.BuildRedisClient(client.ConnInfo&#123;</span><br><span class="line">		Host: h,</span><br><span class="line">		Auth: a,</span><br><span class="line">		Port: p,</span><br><span class="line">	&#125;, cmder.GetDb())</span><br><span class="line"></span><br><span class="line">	stat := analyzer.ScanAllKeys(cli)</span><br><span class="line">    <span class="hljs-comment">// print in command line</span></span><br><span class="line">	stat.Print()</span><br><span class="line">	<span class="hljs-comment">// the object is ready to use</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="github-维护-主要阵地"><a href="#github-维护-主要阵地" class="headerlink" title="github 维护(主要阵地)"></a>github 维护(主要阵地)</h3><ol>
<li>欢迎其他开发者加入</li>
<li>欢迎提issue 反馈问题</li>
<li>欢迎任何有意义的建议</li>
<li>另外欢迎star，不建议fork，建议直接提交PR  ; )</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-08-13T07:14:11.000Z" title="2018-08-13T07:14:11.000Z">2018-08-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/rocksdb/">rocksdb</a></span><span class="level-item">2 minutes lesen (Über 359 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/13/storage/rocksdb/">gorocksdb 的安装与使用</a></h1><div class="content"><h2 id="安装rocksdb"><a href="#安装rocksdb" class="headerlink" title="安装rocksdb"></a>安装rocksdb</h2><p><a href="https://github.com/facebook/rocksdb" target="_blank" rel="noopener">官方参考安装方法</a></p>
<p>去下载 rocksdb <a href="https://github.com/facebook/rocksdb/releases" target="_blank" rel="noopener">最新的发行版</a><br>如下代码:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/facebook/rocksdb/archive/v5.14.2.tar.gz</span><br><span class="line">tar xpf  v5.14.2.tar.gz</span><br><span class="line"><span class="hljs-built_in">cd</span> rocksdb-5.14.2/</span><br><span class="line">make shared_lib -j9</span><br></pre></td></tr></table></figure>

<p>如果编译过程中出错如下</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">util/status.cc: In static member function ‘static const char* rocksdb::Status::CopyState(const char*)’:</span><br><span class="line">util/status.cc:28:15: error: ‘char* strncpy(char*, const char*, size_t)’ output truncated before terminating nul copying as many bytes from a string as its length [-Werror=stringop-truncation]</span><br><span class="line">   std::strncpy(result, state, cch - 1);</span><br><span class="line">   ~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">util/status.cc:19:18: note: length computed here</span><br><span class="line">       std::strlen(state) + 1; // +1 for the null terminator</span><br><span class="line">       ~~~~~~~~~~~^~~~~~~</span><br><span class="line">cc1plus: all warnings being treated as errors</span><br><span class="line">make: *** [Makefile:650: shared-objects/util/status.o] Error 1</span><br></pre></td></tr></table></figure>

<p>需要打开<code>util/status.cc</code>修改第 28行改为</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">strncpy</span>(result, state, cch);</span><br></pre></td></tr></table></figure>

<p>然后继续编译完成<br>然后执行如下命令进行安装</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">cd</span> includes</span><br><span class="line"><span class="hljs-comment"># 拷贝头文件到 include目录</span></span><br><span class="line">cp -r rocksdb /usr/lib/</span><br><span class="line">sudo su</span><br><span class="line">cp librocksdb.so.5.14.2 /usr/lib/</span><br><span class="line"><span class="hljs-built_in">cd</span> /usr/lib</span><br><span class="line">ln -sf librocksdb.so.5.14.2 librocksdb.so</span><br><span class="line">ln -sf librocksdb.so.5.14.2 librocksdb.so.5</span><br><span class="line">ln -sf librocksdb.so.5.14.2 librocksdb.so.5.14</span><br></pre></td></tr></table></figure>

<h2 id="安装其他依赖"><a href="#安装其他依赖" class="headerlink" title="安装其他依赖"></a>安装其他依赖</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zlib - a library for data compression.</span><br><span class="line">bzip2 - a library for data compression.</span><br><span class="line">lz4 - a library for extremely fast data compression.</span><br><span class="line">snappy - a library for fast data compression.</span><br><span class="line">zstandard - Fast real-time compression algorithm.</span><br></pre></td></tr></table></figure>

<h2 id="安装-gorocksdb"><a href="#安装-gorocksdb" class="headerlink" title="安装 gorocksdb"></a>安装 gorocksdb</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CGO_CFLAGS=&quot;-I/path/to/rocksdb/include&quot; \</span><br><span class="line">CGO_LDFLAGS=&quot;-L/path/to/rocksdb -lrocksdb -lstdc++ -lm -lz -lbz2 -lsnappy -llz4 -lzstd&quot; \</span><br><span class="line">  go get github.com/tecbot/gorocksdb</span><br></pre></td></tr></table></figure>

<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight golang hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> (</span><br><span class="line">    <span class="hljs-string">"github.com/tecbot/gorocksdb"</span></span><br><span class="line">    <span class="hljs-string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Test</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">    opts := gorocksdb.NewDefaultOptions()</span><br><span class="line">    opts.SetCreateIfMissing(<span class="hljs-literal">true</span>)</span><br><span class="line">    opts.SetCompression(gorocksdb.NoCompression)</span><br><span class="line">    opts.SetWriteBufferSize(<span class="hljs-number">671088640</span>)</span><br><span class="line">    db, err := gorocksdb.OpenDb(opts, <span class="hljs-string">"test"</span>)</span><br><span class="line">    wopt := gorocksdb.NewDefaultWriteOptions()</span><br><span class="line">    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;</span><br><span class="line">        log.Printf(<span class="hljs-string">"%v\n"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">defer</span> db.Close()</span><br><span class="line">    db.Put(wopt, []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"data"</span>), []<span class="hljs-keyword">byte</span>(<span class="hljs-string">"value"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-04-13T07:14:11.000Z" title="2018-04-13T07:14:11.000Z">2018-04-13</time><span class="level-item"><a class="link-muted" href="/categories/container/">container</a><span> / </span><a class="link-muted" href="/categories/container/docker/">docker</a></span><span class="level-item">a minute lesen (Über 171 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/04/13/container/docker/">docker 简易笔记</a></h1><div class="content"><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>三个基本概念： Image, Contrainer, Repository</p>
<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><p>只读模板，预装一些东西</p>
<h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>启动、开始、停止、删除 – 隔离<br>启动时，在镜像上层创建一层可写层</p>
<h3 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h3><p>用来存放images</p>
<h2 id="Docker-命令"><a href="#Docker-命令" class="headerlink" title="Docker 命令"></a>Docker 命令</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo </span><br><span class="line"></span><br><span class="line"># 启动docker服务</span><br><span class="line">systemctl start docker.service</span><br><span class="line"></span><br><span class="line"># 列出本地镜像</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"># 搜索镜像</span><br><span class="line">docker search +name</span><br><span class="line"></span><br><span class="line">docker run -t -i centos /bin/bash</span><br><span class="line"></span><br><span class="line">docker rm </span><br><span class="line">docker rmi</span><br><span class="line">docker ps</span><br><span class="line">docker save filename</span><br><span class="line">docker load --input filename</span><br><span class="line">docker logs 查看容器的输出信息</span><br><span class="line">docker ps   查看容器的状态信息</span><br></pre></td></tr></table></figure>

<h2 id="Docker-file"><a href="#Docker-file" class="headerlink" title="Docker file"></a>Docker file</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 以centos latest 作为基础</span><br><span class="line">FROM  centos:latest</span><br><span class="line"></span><br><span class="line"># 维护者</span><br><span class="line">MAINTAINER wenwen</span><br><span class="line"></span><br><span class="line"># 执行命令</span><br><span class="line">RUN yum install vi</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">ADD /home/wenwen/1.txt</span><br><span class="line"></span><br><span class="line">EXPOSE port</span><br><span class="line"></span><br><span class="line">CMD nano</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">docker build -t &quot;&quot; &#123;dir&#125;</span><br></pre></td></tr></table></figure>

<h2 id="docker-registry"><a href="#docker-registry" class="headerlink" title="docker-registry"></a>docker-registry</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-04-13T07:14:11.000Z" title="2018-04-13T07:14:11.000Z">2018-04-13</time><span class="level-item"><a class="link-muted" href="/categories/container/">container</a><span> / </span><a class="link-muted" href="/categories/container/k8s/">k8s</a></span><span class="level-item">2 minutes lesen (Über 301 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/04/13/container/k8s_commands/">k8s 常用命令笔记</a></h1><div class="content"><h3 id="k8s-常用命令"><a href="#k8s-常用命令" class="headerlink" title="k8s 常用命令"></a>k8s 常用命令</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">kubectl version</span><br><span class="line">kubectl cluster-info</span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line">kubectl run kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1 --port=8080</span><br><span class="line"># 当完成run的时候就相当于部署了一个应用</span><br><span class="line">kubectl get deployments</span><br><span class="line"># expose 后相当于  service</span><br><span class="line">kubectl expose deployment hello-node --type=LoadBalancer</span><br><span class="line">kubectl get services</span><br><span class="line"></span><br><span class="line">kubectl describe pods</span><br><span class="line">kubectl get pods -o wide</span><br><span class="line"></span><br><span class="line">kubectl logs $POD_NAME</span><br><span class="line">kubectl exec -ti $POD_NAME bash</span><br><span class="line">kubectl exec $POD_NAME env</span><br><span class="line">kubectl describe services/kubernetes-bootcamp</span><br><span class="line">export NODE_PORT=$(kubectl get services/kubernetes-bootcamp -o go-template=&apos;&#123;&#123;(index .spec.ports 0).nodePort&#125;&#125;&apos;)</span><br><span class="line">echo NODE_PORT=$NODE_PORT</span><br><span class="line">kubectl scale deployments/kubernetes-bootcamp --replicas=2</span><br><span class="line">kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2</span><br><span class="line"></span><br><span class="line"># 看是否更新完</span><br><span class="line">kubectl rollout status deployments/kubernetes-bootcamp</span><br><span class="line">kubectl rollout undo deployments/kubernetes-bootcamp</span><br><span class="line">kubectl get events</span><br><span class="line">kubectl config view</span><br><span class="line">kubectl delete service hello-node</span><br><span class="line">kubectl delete deployment hello-node</span><br><span class="line"></span><br><span class="line">kubectl create -f https://k8s.io/docs/user-guide/walkthrough/pod-nginx-with-label.yaml</span><br><span class="line">kubectl apply -f https://k8s.io/docs/user-guide/walkthrough//deployment-update.yaml</span><br><span class="line"></span><br><span class="line">kubectl get pods -l app=nginx</span><br><span class="line">kubectl delete pod -l app=nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl create configmap example-redis-config --from-file=https://k8s.io/docs/tutorials/configuration/configmap/redis/redis-config</span><br><span class="line">kubectl get configmap example-redis-config -o yaml</span><br></pre></td></tr></table></figure>

<h3 id="在一个k8s集群内部各个pod默认跟其他服务与pod是可见的"><a href="#在一个k8s集群内部各个pod默认跟其他服务与pod是可见的" class="headerlink" title="在一个k8s集群内部各个pod默认跟其他服务与pod是可见的"></a>在一个k8s集群内部各个pod默认跟其他服务与pod是可见的</h3><p>一个Pod可以包含多个应用， 但一个pod里面的应用应该是强绑定的，共享存储网络，跟一些容器信息</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2017/12/14/storage/redis/redis_standards/"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59422638-49759700-8e03-11e9-8bdd-dd708ca69e1f.png" alt="redis 使用规范"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-14T07:14:11.000Z" title="2017-12-14T07:14:11.000Z">2017-12-14</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">6 minutes lesen (Über 844 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/14/storage/redis/redis_standards/">redis 使用规范</a></h1><div class="content"><h2 id="key-value规范"><a href="#key-value规范" class="headerlink" title="key/value规范"></a>key/value规范</h2><ol>
<li>所有的key 应该有合理的业务前缀</li>
<li>key 不应该包含特殊字符，应尽量使用常见的字母，数字， 下划线等组合</li>
<li>key 的大小应该保证在<code>16kb</code> 之内</li>
<li>value 的大小应该保证在<code>1M</code>之内， 拒绝bigkey(防止网卡流量、慢查询)</li>
<li>string类型控制在10KB以内，hash、list、set、zset元素个数不要超过5000。</li>
<li>控制key的生命周期，redis不是垃圾桶, 能过期的key一定要设置过期时间</li>
</ol>
<h2 id="数据类型使用注意"><a href="#数据类型使用注意" class="headerlink" title="数据类型使用注意"></a>数据类型使用注意</h2><ol>
<li>hash 不推荐使用 <code>hkeys</code> 命令除非hash表的尺寸非常小， 否则推荐使用scan</li>
<li>set/zset/list 需要遍历整个列表也尽量使用<code>scan</code>与 <code>lindex</code>等命令</li>
<li>非字符串的bigkey，不要使用del删除，使用hscan、sscan、zscan方式渐进式删除，同时要注意防止bigkey过期时间自动删除问题(例如一个200万的zset设置1小时过期，会触发del操作，造成阻塞，而且该操作不会不出现在慢查询中(latency可查))</li>
<li>选择适合的数据类型, 注意节省内存和性能之间的平衡</li>
</ol>
<h2 id="命令使用"><a href="#命令使用" class="headerlink" title="命令使用"></a>命令使用</h2><ol>
<li><p>O(N)命令关注N的数量</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如hgetall、lrange、smembers、zrange、sinter等并非不能使用，但是需要明确N的值。有遍历的需求可以使用hscan、sscan、zscan代替。</span><br></pre></td></tr></table></figure>
</li>
<li><p>禁用命令</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">禁止线上使用keys、flushall、flushdb等，通过redis的rename机制禁掉命令，或者使用scan的方式渐进式处理。</span><br></pre></td></tr></table></figure>
</li>
<li><p>不推荐使用select,  新业务禁止使用 select</p>
</li>
<li><p>用批量操作提高效率, 但要注意控制一次批量操作的元素个数(例如500以内，实际也和元素字节数有关)。</p>
</li>
<li><p>Redis事务功能较弱，不建议过多使用</p>
</li>
<li><p>必要情况下使用monitor命令时，要注意不要长时间使用</p>
</li>
</ol>
<h2 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h2><ol>
<li>避免多个应用使用一个Redis实例, 不相干的业务拆分，公共数据做服务化</li>
<li>使用带有连接池的数据库，可以有效控制连接，同时提高效率</li>
<li>高并发下建议客户端添加熔断功能(例如netflix hystrix)</li>
<li>设置合理的密码</li>
<li>根据自身业务类型，选好maxmemory-policy(最大内存淘汰策略)，设置好过期时间</li>
</ol>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">volatile-lru: 即超过最大内存后，在过期键中使用lru算法进行key的剔除，保证不过期数据不被删除，但是可能会出现OOM问题</span><br><span class="line">allkeys-lru：根据LRU算法删除键，不管数据有没有设置超时属性，直到腾出足够空间为止。</span><br><span class="line">allkeys-random：随机删除所有键，直到腾出足够空间为止。</span><br><span class="line">volatile-random:随机删除过期键，直到腾出足够空间为止。</span><br><span class="line">volatile-ttl：根据键值对象的ttl属性，删除最近将要过期数据。如果没有，回退到noeviction策略。</span><br><span class="line">noeviction：不会剔除任何数据，拒绝所有写入操作并返回客户端错误信息&quot;(error) OOM command not allowed when used memory&quot;，此时Redis只响应读操作。</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-13T07:14:11.000Z" title="2017-12-13T07:14:11.000Z">2017-12-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">8 minutes lesen (Über 1205 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/13/storage/redis/monitoring/">redis 简谈redis监控</a></h1><div class="content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>由于redis是一个内存型的数据库，关注的点势必跟MySQL等非内存型的数据库相差比较多， 因此有必要单独对redis的监控关注项进行梳理。<br>此外由于redis的单线程模型， 以及速度要求非常高，因此对于redis的监控需要因事制宜。</p>
<h3 id="监控项"><a href="#监控项" class="headerlink" title="监控项"></a>监控项</h3><h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><p>由于redis是内存型数据库，因此对于内存的需求是最大的需求， 监控项里面最重要的也是对于内存的监控，一般出问题，大概率是内存满掉的问题。<br>一般内存满了之后会导致一系列的问题，比如逐出了不该逐出的key、写不进数据、 超时阻塞等问题。 对于内存的监控是至关重要的。<br>一般一个合理的范围是在 30% 到70%之间。而超过了80%就需要报警和升级了。</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; info memory</span><br><span class="line"><span class="hljs-comment"># Memory</span></span><br><span class="line">used_memory:108476200</span><br><span class="line">used_memory_human:103.45M</span><br><span class="line">used_memory_rss:129523712</span><br><span class="line">used_memory_rss_human:123.52M</span><br><span class="line">used_memory_peak:109672760</span><br><span class="line">used_memory_peak_human:104.59M</span><br><span class="line">total_system_memory:16658898944</span><br><span class="line">total_system_memory_human:15.51G</span><br><span class="line">used_memory_lua:37888</span><br><span class="line">used_memory_lua_human:37.00K</span><br><span class="line">maxmemory:4294967296</span><br><span class="line">maxmemory_human:4.00G</span><br><span class="line">maxmemory_policy:volatile-lru</span><br><span class="line">mem_fragmentation_ratio:1.19</span><br><span class="line">mem_allocator:jemalloc-4.0.3</span><br><span class="line">10.1.9.164:7300&gt;</span><br></pre></td></tr></table></figure>

<h3 id="大Key，-慢查询"><a href="#大Key，-慢查询" class="headerlink" title="大Key， 慢查询"></a>大Key， 慢查询</h3><p>另外一个比较常见的导致线上问题的一大因素是对于redis的不合理的使用，如 大key与慢查询<br>一般而言redis的key与数据越大， 导致的查询时长就越长， 加上redis本身是单线程的模型，因此这类查询往往会影响到其他查询的正常进行， 对大key的控制一方面可以通过中间件或者proxy 等手段来截断或者拒绝， 一方面也是需要使用一定的手段如 redis的 <code>slowlog get</code>命令来查看。<br>有了能获取的方法，那自然就可以对这些东西进行监控并合理的进行报警。 一般来讲redis模型中， 还是以尽量不出现慢查询为宜， 一旦出现慢查询就应该立即报警。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; slowlog get</span><br><span class="line">1) 1) (integer) 155</span><br><span class="line">   2) (integer) 1545025300</span><br><span class="line">   3) (integer) 19422</span><br><span class="line">   4) 1) &quot;COMMAND&quot;</span><br><span class="line">2) 1) (integer) 154</span><br><span class="line">   2) (integer) 1544754674</span><br><span class="line">   3) (integer) 11571</span><br><span class="line">   4) 1) &quot;scan&quot;</span><br><span class="line">      2) &quot;26005&quot;</span><br><span class="line">      3) &quot;MATCH&quot;</span><br><span class="line">      4) &quot;*&quot;</span><br><span class="line">      5) &quot;COUNT&quot;</span><br><span class="line">      6) &quot;10000&quot;</span><br></pre></td></tr></table></figure>

<h3 id="连接数"><a href="#连接数" class="headerlink" title="连接数"></a>连接数</h3><p>redis在与客户端进行通信也是维护了连接的， 这些连接用来处理服务端与redis server之间的命令发送与数据发送等等 另外redis的最大连接数是有上限的 可以通过命令 <code>config get maxclients</code>来取得， 也可以使用<code>info clients</code>来看连接的使用情况，一般而言，连接数只要使用不满其实是不会出现太多的问题的， 但一定用满了，则会导致应用端错误。 因此对于连接数的监控也是以比率为标准比较好， 建议合理的范围是 &lt; 60%, 对于超过80%的情况应给予报警</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info clients</span><br><span class="line">#Clients</span><br><span class="line">connected_clients:621</span><br><span class="line">client_longest_output_list:0</span><br><span class="line">client_biggest_input_buf:0</span><br><span class="line">blocked_clients:0</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET maxclients</span><br><span class="line">    ##1) &quot;maxclients&quot;</span><br><span class="line">    ##2) &quot;10000&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><p>CPU对于redis来说也是比较重要的需要关注的一个项， 一般跟QPS直接相关， QPS越高，CPU使用的也就越高。<br>对于redis服务来讲， CPU 跟其他服务的要求差别也不大， 不正常区间是 &lt;70% 超过80%则需要报警。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; info cpu</span><br><span class="line"># CPU</span><br><span class="line">used_cpu_sys:88088.66</span><br><span class="line">used_cpu_user:39641.02</span><br><span class="line">used_cpu_sys_children:40.78</span><br><span class="line">used_cpu_user_children:131.68</span><br><span class="line">10.1.9.164:7300&gt;</span><br></pre></td></tr></table></figure>

<h4 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h4><p>QPS 即每秒钟Redis接受的请求数量，不同的Key的大小支持的QPS对于Redis是不同的， 因此单一的对redis的QPS进行监控可能意义不大。<br>如果要做redis QPS的监控应该与历史同期相比较，是否有剧增等情况。 还有一个可以参照点就是经验值， 一般这个配置的redis可以承受多少的QPS。 通过经验值与历史对比两个标准来决定是否需要报警。一般是历史同期的两倍，且比高峰期高的时候，是应该报警的。</p>
<p>QPS 可以通过计算两个时间间隔内执行的总命令数量来计算出来</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; info  stats</span><br><span class="line"># Stats</span><br><span class="line">total_connections_received:215774</span><br><span class="line">total_commands_processed:2980658450</span><br><span class="line">instantaneous_ops_per_sec:50</span><br><span class="line">total_net_input_bytes:1135673367887</span><br><span class="line">total_net_output_bytes:594951090244</span><br><span class="line">instantaneous_input_kbps:30.66</span><br><span class="line">instantaneous_output_kbps:13.65</span><br><span class="line">rejected_connections:0</span><br><span class="line">sync_full:0</span><br><span class="line">sync_partial_ok:0</span><br><span class="line">sync_partial_err:0</span><br><span class="line">expired_keys:161591</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:112552664</span><br><span class="line">keyspace_misses:809125690</span><br><span class="line">pubsub_channels:0</span><br><span class="line">pubsub_patterns:0</span><br><span class="line">latest_fork_usec:3349</span><br><span class="line">migrate_cached_sockets:0</span><br><span class="line">10.1.9.164:7300&gt;</span><br></pre></td></tr></table></figure>

<h4 id="网络IO"><a href="#网络IO" class="headerlink" title="网络IO"></a>网络IO</h4><p>网络IO就是redis在处理命令的时候占用的网络的流入与流出的量， 一般而言， 网络IO是较少关注的一个点， 但在网络达到带宽的上限的时候我们还是应该重视起来， 因为这个时候其他的东西是会阻塞的， 一般推荐的报警值为超过网络带宽的 80%</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-09-13T07:14:11.000Z" title="2017-09-13T07:14:11.000Z">2017-09-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">2 minutes lesen (Über 308 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/09/13/apps/tidb/">Tidb 笔记</a></h1><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>TIDB是一种分布式高可用实现MySQL协议的可动态扩容的数据库<br>动态扩容是指计算能力与存储空间两个维度的动态扩容<br>tidb 由 tidb server， PDserver 与 TIKV组成<br>基本结构如下图<br><img src="imgs/tidb-architecture.png" alt="TIDB架构"></p>
<h2 id="TIDB"><a href="#TIDB" class="headerlink" title="TIDB"></a>TIDB</h2><p>TIDB 是一个无状态可以动态扩展的服务， 本身并不存储任何数据</p>
<h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h3><ol>
<li>接收SQL请求</li>
<li>处理SQL相关的逻辑</li>
<li>与PD Server 通信定位数据实际存储位置</li>
<li>与TIKV实际交换数据</li>
<li>返回数据</li>
</ol>
<h2 id="PD-server"><a href="#PD-server" class="headerlink" title="PD server"></a>PD server</h2><p>PD Server 负责整个集群信息的管理与通信， 通常要部署奇数台</p>
<h3 id="主要功能-1"><a href="#主要功能-1" class="headerlink" title="主要功能"></a>主要功能</h3><ol>
<li>存储集群数据元信息</li>
<li>管理与负载均衡TIKV， 并负责数据迁移</li>
<li>分配全局唯一单调递增ID</li>
</ol>
<h2 id="TIKV"><a href="#TIKV" class="headerlink" title="TIKV"></a>TIKV</h2><p>TIKV 是一种分布式事务型Key-Value型存储， 它是负责整个TIDB集群所有的实际数据存储的。<br>它使用Raft协议来保证集群数据的一致性与故障恢复，区域是它最基本的存储单元，所有不同节点<br>上的区域副本构成了一个Raft的分组</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-09-13T07:14:11.000Z" title="2017-09-13T07:14:11.000Z">2017-09-13</time><span class="level-item"><a class="link-muted" href="/categories/lang/">lang</a></span><span class="level-item">2 minutes lesen (Über 256 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/09/13/langs/golang/goland/">Golang 简介</a></h1><div class="content"><h2 id="IDE-选择"><a href="#IDE-选择" class="headerlink" title="IDE 选择"></a>IDE 选择</h2><h3 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h3><h3 id="goland-（收费）"><a href="#goland-（收费）" class="headerlink" title="goland （收费）"></a>goland （收费）</h3><p>需要装的插件列表</p>
<ol>
<li>material theme UI</li>
<li>m</li>
</ol>
<p>jetbrains 出品， 省去了很多的配置麻烦，而且用IDEA的用户可以无缝切换到这个的使用。</p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="SQL查询的Rows不关闭的时候回造成阻塞的问题"><a href="#SQL查询的Rows不关闭的时候回造成阻塞的问题" class="headerlink" title="SQL查询的Rows不关闭的时候回造成阻塞的问题"></a>SQL查询的Rows不关闭的时候回造成阻塞的问题</h3><p>对此的英文解释大概意思是， 如果不关闭rows， 缓冲区就有未读完的数据， 然后就造成了连接阻塞，影响接下来的查询， 最终会导致连接池的连接全部用满。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Query(..) returns a rows struct which must be closed or completely iterated (with for rows.Next()). Otherwise there is unread data on the connection stream and the connection blocks.</span><br></pre></td></tr></table></figure>

<p>如果需要执行但不需要结果可以用 <code>db.Exec(..)</code></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Simple solution: use db.Exec(..) instead. Does it work then?</span><br></pre></td></tr></table></figure>

<p>gorm 的问题</p>
<figure class="highlight go hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Raw.Row()</span><br></pre></td></tr></table></figure>

<p>  如果这个row不被消费则会造成这个问题<br>如果不想消费</p>
<figure class="highlight go hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Exec()</span><br></pre></td></tr></table></figure>

<h2 id="golang-初始化顺序"><a href="#golang-初始化顺序" class="headerlink" title="golang 初始化顺序"></a>golang 初始化顺序</h2><p><img src="https://user-images.githubusercontent.com/7270177/59737472-62ad9600-9290-11e9-92e7-54556e4618de.png" alt="image"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-03-18T07:14:11.000Z" title="2017-03-18T07:14:11.000Z">2017-03-18</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">15 minutes lesen (Über 2250 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/03/18/storage/mysql/roll_back/">Mysql 闪回方案设计</a></h1><div class="content"><h1 id="mysql-数据闪回"><a href="#mysql-数据闪回" class="headerlink" title="mysql 数据闪回"></a>mysql 数据闪回</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>数据闪回属于数据恢复的一个范畴, 常见的数据恢复的方法有很多， 但都大同小异。<br>主要有以下两种方案：</p>
<ol>
<li>进行变更之前把变更前的数据存储下来用于恢复</li>
<li>基于全量备份+ binlog增量备份的方式</li>
</ol>
<p>这两种方案，私下里操作最多的往往是第一种， 因为第一种比较小作坊， 容易操作， 但操作也相对零碎， 人工化， 容易产生失误。第二种是业界许多解决方案的标准， 例如RDS的备份恢复克隆等功能就是按照第二种方案去做的， 但第二种有三个问题， 第一，备份数据比较庞大， 比较多，恢复时间非常久， 第二， 需要有一整套的体系支持（包括不仅限于服务器、运维、等）第三，第二种需要比较大的开发量。需要对binlog 进行订阅解析以及合理的安排， 对备份策略进行合理的程序化定制。</p>
<p>很多企业在发展到一定阶段之后必定会对线上数据变更进行相应的管控， 建立好相应的变更管控的流程。 但这个流程也非万能的， 数据被误操作的概率还是存在， 当数据被误操作后，如何快速恢复到操作前的一个状态， 成了本文主要关注的一个话题。</p>
<h2 id="闪回工具现状"><a href="#闪回工具现状" class="headerlink" title="闪回工具现状"></a>闪回工具现状</h2><h3 id="mysqlbinlog工具配合sed、awk"><a href="#mysqlbinlog工具配合sed、awk" class="headerlink" title="mysqlbinlog工具配合sed、awk"></a>mysqlbinlog工具配合sed、awk</h3><p>该方式先将binlog解析成类SQL的文本，然后使用sed、awk把类SQL文本转换成真正的SQL。</p>
<ul>
<li>优点：当SQL中字段类型比较简单时，可以快速生成需要的SQL，且编程门槛也比较低。</li>
<li>缺点：当SQL中字段类型比较复杂时，尤其是字段中的文本包含HTML代码，用awk、sed等工具时，就需要考虑极其复杂的转义等情况，出错概率很大。</li>
</ul>
<h3 id="给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。"><a href="#给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。" class="headerlink" title="给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。"></a>给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。</h3><ul>
<li>优点：复用了MySQL Server层中binlog解析等代码，一旦稳定之后，无须关心复杂的字段类型，且效率较高。</li>
<li>缺点：在修改前，需要对MySQL的复制代码结构和细节需要较深的了解。版本比较敏感，在MySQL 5.6上做的patch，基本不能用于MySQL 5.7的回滚操作。升级困难，因为patch的代码是分布在MySQL的各个文件和函数中，一旦MySQL代码改变，特别是复制层的重构，升级的难度不亚于完全重新写一个。</li>
</ul>
<h3 id="使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。"><a href="#使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。" class="headerlink" title="使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。"></a>使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。</h3><ul>
<li>优点：使用业界成熟的库，因此稳定性较好，且上手难度较低。</li>
<li>缺点：效率往往较低，且实现上受制于binlog库提供的功能。</li>
</ul>
<p>上述几种实现方式，主要是提供的过滤选项较少，比如不能提供基于SQL类型的过滤，需要回滚一个delete语句，导致在回滚时，需要结合awk、sed等工具进行筛选。</p>
<h2 id="开源方案"><a href="#开源方案" class="headerlink" title="开源方案"></a>开源方案</h2><p>总体来讲如下的两种方案其实是一个原理，其中一个程序化了， 产品化了而已。</p>
<h3 id="美团的-MyFlash"><a href="#美团的-MyFlash" class="headerlink" title="美团的 MyFlash"></a>美团的 MyFlash</h3><p>  <a href="https://github.com/Meituan-Dianping/MyFlash" target="_blank" rel="noopener">MyFlash</a>  是由美团点评公司技术工程部开发维护的一个回滚DML操作的工具。该工具通过解析v4版本的binlog，完成回滚操作。相对已有的回滚工具，其增加了更多的过滤选项，让回滚更加容易。</p>
<ol>
<li>无需把binlog解析成文本，再进行转换。</li>
<li>提供原生的基于库、表、SQL类型、位置、时间等多种过滤方式。</li>
<li>支持MySQL多个版本。</li>
<li>对于数据库的代码重构不敏感，利于升级。</li>
<li>自主掌控binlog解析，提供尽可能灵活的方式。</li>
</ol>
<h2 id="闪回工具分析"><a href="#闪回工具分析" class="headerlink" title="闪回工具分析"></a>闪回工具分析</h2><p> 以上业界的一些闪回方案，基本上都是基于Binlog 去倒腾的， 有一些明显的限制</p>
<ol>
<li>不能针对某条语句(tansaction)进行回滚操作</li>
<li>需要维护binlog, 建立binlog 相关的逻辑体系</li>
<li>人工变更与应用变更不能真正分开(闪回是针对某个表， 某个类型，在某一段时间内的全部数据)</li>
<li>使用起来不方便， 对于普通研发来说成本还是蛮高的</li>
<li>…</li>
</ol>
<h2 id="闪回工具的方案"><a href="#闪回工具的方案" class="headerlink" title="闪回工具的方案"></a>闪回工具的方案</h2><p>为了解决以上所有问题， 主要考虑以下两种方案（两种都是原创）</p>
<h3 id="基于SQL重写与备份的方案"><a href="#基于SQL重写与备份的方案" class="headerlink" title="基于SQL重写与备份的方案"></a>基于SQL重写与备份的方案</h3><p>这种方案的整个大的流程如下：</p>
<p><img src="https://qhyxpicoss.kujiale.com/2019/04/24/LS75DLYKAQBZMRS4AAAAABQ8_768x189.png" alt="AST"></p>
<ol>
<li>变更前备份： 在实际执行语句前，通过对SQL语句的重写，来达到保存变更前状态的一个目的。</li>
<li>变更执行： 进行实际的变更操作</li>
<li>备份恢复： 利用备份的数据进行恢复（一般是自动生成rollback的SQL语句进行执行）</li>
</ol>
<p>上述环节中， 最重的一部分工作就是变更前的备份，其中工作量最大的一部分就是进行SQL的重写，这有可能涉及到AST语法树的部分， 当然对于比较简单的SQL语句， 也用不着AST语法树。<br>这里面最大的工作量就是SQL语句的重写， 利用重写的SQL进行原数据查询， 再将变更前的数据备份下来。</p>
<p>整体的一个流程如下：</p>
<p><img src="https://qhyxpicoss.kujiale.com/2019/04/24/LS75X3QKAQBZOUT4AAAAAAQ8_1125x181.png" alt="ast"></p>
<p>存在的问题： 备份与实际写入之间是存在时间间隔的， 如果这个时间间隔内存在其他变数，则也只能恢复到备份的时候的状态。</p>
<h3 id="基于binlog-映射SQL语句的方案"><a href="#基于binlog-映射SQL语句的方案" class="headerlink" title="基于binlog 映射SQL语句的方案"></a>基于binlog 映射SQL语句的方案</h3><p>对于每一个DML操作， binlog 总是忠实的记录了DML操作的详情，我们可以利用这个详情用于事后恢复数据。<br>但binlog 并未将语句与binlog一一对应起来， 如果要做，可能需要花费的代价比较大，浪费很多的存储空间。<br>由于我们的需求是仅对我们的变更进行回滚，不对其他同类型同时间的变更进行回滚， 所以，我们需要有能力将binlog与我们的变更进行一一对应。<br>整体的操作流程如下：</p>
<p><img src="https://qhyxpicoss.kujiale.com/2019/04/24/LS74QSYKAQBZOUT4AAAAADQ8_749x192.png" alt="binlog"></p>
<p>从图中可以看到， 变更的执行跟数据的备份恢复其实是分开的， 变更执行只是变更执行，不用去卡很多时间点相关的概念， 也不同担心备份的跟实际变更的数据会不一致。<br>避免了上面方案的一个时间差的问题，而且不需要进行SQL语句的重写与反查数据库。</p>
<p>为了能做变更与binlog 的唯一对应， 我们需要对变更执行这个步骤做一些手脚， 加入一个唯一对应的标志。<br>由于binlog 是会忠实记录变更的， 因此我们可以给每个变更生成一个唯一标志， 并把这个唯一标志体现在binlog 里面， 这样我们就实现了变更与binlog的对应。<br>有了这层对应关系我们就可以轻松的对这个变更进行数据的恢复， 从而不影响其他同时间同类型的变更。</p>
<p>数据备份模块也是需要投入开发的一个模块他主要涉及到以下工作：</p>
<ol start="0">
<li>binlog 名称与位点的确定</li>
<li>slave 伪装</li>
<li>binlog 接收与解析</li>
<li>定位变更的binlog</li>
<li>由对应的binlog生成相应的备份</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>就开发量上来讲， 两种方案都是差不多的， 整个周期至少都需要2-3周左右的开发量，<br>我们显然应该采取第二种方案， 因为第二种方案与业界许多方案有比较多的共通之处， 也是比较通用靠谱的一种方案， 而且避免了查询间隔带来的数据不一致问题。<br>而且它与现有生态融合比较好。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-03-13T07:14:11.000Z" title="2017-03-13T07:14:11.000Z">2017-03-13</time><span class="level-item"><a class="link-muted" href="/categories/lang/">lang</a></span><span class="level-item">7 minutes lesen (Über 1104 Worte)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/03/13/langs/golang/index/">golang 学习笔记</a></h1><div class="content"><h1 id="go-doc"><a href="#go-doc" class="headerlink" title="go-doc"></a>go-doc</h1><p>golang 中文文档<br>本文主要分三部分来帮助初学者能够顺利入坑<code>golang</code>， 第一部分主要是讲golang语法， 第二部分主要是讲golang的工程化的东西，附带会推荐一些常用的三方包。<br>第三部分则主要是介绍这门语言的编程思想，常见的思路。<br>学习一门语言，主要是学习语法、工程化、以及这门语言的编程思想。<br>附录则会讲一些工具的使用</p>
<h2 id="golang-基本语法"><a href="#golang-基本语法" class="headerlink" title="golang 基本语法"></a>golang 基本语法</h2><p>参见<a href="demo">demo</a>下面的， 基本10分钟看完就学会了</p>
<h2 id="golang-工程化"><a href="#golang-工程化" class="headerlink" title="golang 工程化"></a>golang 工程化</h2><p>golang 工程化是教大家如何配置golang项目，如何组织代码结构，以及如何调试分析，进行单元测试与性能测试等等。工程化是一门语言离不开的话题，好的工程化与工具可以令人事半功倍。</p>
<h3 id="golang-开发工具"><a href="#golang-开发工具" class="headerlink" title="golang 开发工具"></a>golang 开发工具</h3><p>常见的golang开发工具有非常多，但有着比较好的代码补全，以及其他提高编程体验的IDE却为数不多。目前市面上比较流行的开发工具主要有如下几个，也可能有些高手手写vim插件使用vim之类的，此类的不做说明了。</p>
<ol>
<li>goland</li>
<li>vscode</li>
<li>lite ide</li>
</ol>
<p>以上三个IDE(集成开发环境) 我更倾向于使用jetbrains 的 goland, 虽然goland目前有成吨的bug, 但由于习惯问题，我还是习惯使用，大家也可以根据自己的习惯来使用相应的IDE。后面会有专门的文章对goland下如何配置golang项目进行详细说明。</p>
<h3 id="golang-项目组织结构"><a href="#golang-项目组织结构" class="headerlink" title="golang 项目组织结构"></a>golang 项目组织结构</h3><p>一般而言一个非库型golang项目会存在一个main.go, 用作程序的主入口。<br>同时也会存在一些模块，跟一些配置文件。这些配置文件与模块的推荐的放置方式如下。后面也会有专题去说明我们这样放置的道理与好处。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module1_dir</span><br><span class="line">module2_dir</span><br><span class="line">others.go</span><br><span class="line">main.go</span><br><span class="line">config_file</span><br><span class="line">readme</span><br></pre></td></tr></table></figure>

<h3 id="dep与-go-module"><a href="#dep与-go-module" class="headerlink" title="dep与 go module"></a><code>dep</code>与 <code>go module</code></h3><p> <code>dep</code> 是 <code>go module</code> 推出之前半官方的一个依赖管理工具，它使用起来非常简单， 它的总体思想是把依赖代码集成到项目中的vendor目录去，但不需要手动管理这些依赖。这样做有一个好处：在编译期不用下载额外的依赖。但也有个坏处：会使得代码仓库变得比较庞大， 除非使用ignore 忽略这个vendor目录</p>
<ol start="2">
<li><code>go module</code> 是golang官方推出的在 <code>1.11</code>版本后用来取代其他各种依赖管理工具的官方工具，它的思想跟<code>maven</code>的思想有点像， 与<code>dep</code>不同的就是它会把依赖不放入项目中去，而是管理到 <code>GOPATH</code>下面。这样做可以节省很多的代码仓库的空间。在进行编译的时候提前把依赖下载好，就不存在编译的时候下载依赖的问题了， 是以后的方向。</li>
</ol>
<h3 id="golang-生成各个平台下的可执行文件"><a href="#golang-生成各个平台下的可执行文件" class="headerlink" title="golang 生成各个平台下的可执行文件"></a>golang 生成各个平台下的可执行文件</h3><p>golang 生成其他平台的二进制文件是非常非常简单的，只需要进行简单的一个环境变量的设置即可生成 mac/windows/linux 等平台下的二进制文件， 二进制文件可以直接运行而不需要像java一样需要一个 <code>jre</code>, 这也许就是golang的一个简单哲学。</p>
<h3 id="golang-单元测试与性能测试"><a href="#golang-单元测试与性能测试" class="headerlink" title="golang 单元测试与性能测试"></a>golang 单元测试与性能测试</h3><p>golang提供了简单的单元测试与性能测试的功能， 虽然简单却很强大，后面会专门文档来说明如何去写单元测试与性能测试。<br>golang的单元测试与性能测试的文件需要以 <code>_test.go</code>结尾<br>单测方法和性能测试方法需要用类似如下方法声名。</p>
<figure class="highlight go hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 单元测试需要以Test开头的函数名称</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestGenerateQrCode</span><span class="hljs-params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	GenerateQrCode()</span><br><span class="line">	<span class="hljs-comment">// t.Fail()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 性能测试需要以Benchmark 开头的函数名称</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkGenerateQrCode</span><span class="hljs-params">(b *testing.B)</span></span> &#123;</span><br><span class="line">	GenerateQrCode()</span><br><span class="line">	<span class="hljs-comment">// b.ReportAllocs()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="golang-内存分析"><a href="#golang-内存分析" class="headerlink" title="golang 内存分析"></a>golang 内存分析</h3><p><code>pprof</code></p>
<h3 id="golang-远程调试"><a href="#golang-远程调试" class="headerlink" title="golang 远程调试"></a>golang 远程调试</h3><p><code>dlv</code></p>
<h2 id="golang-编程思想"><a href="#golang-编程思想" class="headerlink" title="golang 编程思想"></a>golang 编程思想</h2><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="go-fmt"><a href="#go-fmt" class="headerlink" title="go fmt"></a>go fmt</h3><h3 id="go-doc-1"><a href="#go-doc-1" class="headerlink" title="go doc"></a>go doc</h3><h3 id="go-mod"><a href="#go-mod" class="headerlink" title="go mod"></a>go mod</h3></div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/2/">Zurück</a></div><div class="pagination-next"><a href="/page/4/">Weiter</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link is-current" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/7/">7</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="winjeg"></figure><p class="title is-size-4 is-block line-height-inherit">winjeg</p><p class="is-size-6 is-block">Sleeping is good</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Hangzhou. Zhejiang. China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">70</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories"><p class="title">20</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">41</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/winjeg" target="_blank" rel="noopener">Folgen</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/winjeg"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com/winjeg"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/winjeg"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://winjeg.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Github</span></span><span class="level-right"><span class="level-item tag">winjeg.github.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Kategorien</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/application/"><span class="level-start"><span class="level-item">application</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/biz/"><span class="level-start"><span class="level-item">biz</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/container/"><span class="level-start"><span class="level-item">container</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/container/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/container/k8s/"><span class="level-start"><span class="level-item">k8s</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/gramma/"><span class="level-start"><span class="level-item">gramma</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/lang/"><span class="level-start"><span class="level-item">lang</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/os/"><span class="level-start"><span class="level-item">os</span></span><span class="level-end"><span class="level-item tag">16</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/os/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/other/"><span class="level-start"><span class="level-item">other</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/"><span class="level-start"><span class="level-item">storage</span></span><span class="level-end"><span class="level-item tag">26</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/storage/bigtable/"><span class="level-start"><span class="level-item">bigtable</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/etcd/"><span class="level-start"><span class="level-item">etcd</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/middleware/"><span class="level-start"><span class="level-item">middleware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/mongodb/"><span class="level-start"><span class="level-item">mongodb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/redis/"><span class="level-start"><span class="level-item">redis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/rocksdb/"><span class="level-start"><span class="level-item">rocksdb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Letzte Einträge</h3><article class="media"><a class="media-left" href="/2020/10/23/base/jwt/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/96998573-3f6eb700-1566-11eb-8c16-ca031f895b69.png" alt="JWT 基本原理笔记"></p></a><div class="media-content size-small"><p><time dateTime="2020-10-23T11:14:11.000Z">2020-10-23</time></p><p class="title is-6"><a class="link-muted" href="/2020/10/23/base/jwt/">JWT 基本原理笔记</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/container/">container</a> / <a class="link-muted" href="/categories/container/docker/">docker</a></p></div></article><article class="media"><a class="media-left" href="/2020/09/14/apps/git_recommend/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59480122-fb5ba480-8e91-11e9-9c26-7f8d6d97868a.png" alt="Git提交规范"></p></a><div class="media-content size-small"><p><time dateTime="2020-09-14T14:14:11.000Z">2020-09-14</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/14/apps/git_recommend/">Git提交规范</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/tools/">tools</a></p></div></article><article class="media"><a class="media-left" href="/2020/07/04/others/shuangpin/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/86505485-da952280-bdf7-11ea-84b7-26e732485417.png" alt="输入法之双拼"></p></a><div class="media-content size-small"><p><time dateTime="2020-07-04T02:14:11.000Z">2020-07-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/04/others/shuangpin/">输入法之双拼</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/tools/">tools</a></p></div></article><article class="media"><a class="media-left" href="/2020/05/30/langs/golang/code_style/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59482717-9f4a4d80-8e9c-11e9-82b0-58254e0f4c4b.png" alt="Golang的代码风格"></p></a><div class="media-content size-small"><p><time dateTime="2020-05-30T07:14:11.000Z">2020-05-30</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/30/langs/golang/code_style/">Golang的代码风格</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/lang/">lang</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2019-12-02T07:14:11.000Z">2019-12-02</time></p><p class="title is-6"><a class="link-muted" href="/2019/12/02/langs/golang/json/">Golang JSON 详解</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/lang/">lang</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archive</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/11/"><span class="level-start"><span class="level-item">November 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/03/"><span class="level-start"><span class="level-item">March 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/09/"><span class="level-start"><span class="level-item">September 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/08/"><span class="level-start"><span class="level-item">August 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/07/"><span class="level-start"><span class="level-item">July 2016</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/05/"><span class="level-start"><span class="level-item">May 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/04/"><span class="level-start"><span class="level-item">April 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/03/"><span class="level-start"><span class="level-item">March 2016</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/02/"><span class="level-start"><span class="level-item">February 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2016/01/"><span class="level-start"><span class="level-item">January 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2015/09/"><span class="level-start"><span class="level-item">September 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2015/03/"><span class="level-start"><span class="level-item">March 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/11/"><span class="level-start"><span class="level-item">November 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/09/"><span class="level-start"><span class="level-item">September 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/08/"><span class="level-start"><span class="level-item">August 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/07/"><span class="level-start"><span class="level-item">July 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/06/"><span class="level-start"><span class="level-item">June 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/05/"><span class="level-start"><span class="level-item">May 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/03/"><span class="level-start"><span class="level-item">March 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/02/"><span class="level-start"><span class="level-item">February 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2014/01/"><span class="level-start"><span class="level-item">January 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2013/11/"><span class="level-start"><span class="level-item">November 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2013/09/"><span class="level-start"><span class="level-item">September 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2013/03/"><span class="level-start"><span class="level-item">March 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/antd/"><span class="tag">antd</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bigtable/"><span class="tag">bigtable</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/biz/"><span class="tag">biz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cicd/"><span class="tag">cicd</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/container/"><span class="tag">container</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devops/"><span class="tag">devops</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ftp/"><span class="tag">ftp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gramma/"><span class="tag">gramma</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/input/"><span class="tag">input</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/json/"><span class="tag">json</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lang/"><span class="tag">lang</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ldap/"><span class="tag">ldap</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multi-media/"><span class="tag">multi-media</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/notes/"><span class="tag">notes</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/npm/"><span class="tag">npm</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openapi/"><span class="tag">openapi</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/project/"><span class="tag">project</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rocksdb/"><span class="tag">rocksdb</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/standards/"><span class="tag">standards</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tidb/"><span class="tag">tidb</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tidis/"><span class="tag">tidis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tutorial/"><span class="tag">tutorial</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yaml/"><span class="tag">yaml</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%B4%A2%E5%BC%95/"><span class="tag">索引</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="winjeg&#039;s blog" height="28"></a><p class="size-small"><span>&copy; 2020 winjeg</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-Hans");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://winjeg.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Tippen Sie etwas..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Tippen Sie etwas...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Kategorien","tags":"Tags"});
        });</script></body></html>