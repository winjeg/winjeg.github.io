<!DOCTYPE html>
<html  lang="zh" >
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <title>Mysql 主从同步相关的知识 | winjeg's blog</title>
    <meta name="description" content="同步时mysql -&gt; backup  123456mkdir -p &#x2F;backup&#x2F;mysqltar -izxvf &#x2F;backup&#x2F;hins1851643_data_20170301022021.tar.gz -C &#x2F;backup&#x2F;mysql&#x2F;cp &#x2F;home&#x2F;wenwen&#x2F;backup-my.cnf &#x2F;backup&#x2F;mysql&#x2F;backup-my.cnfinnobackupex --us">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql 主从同步相关的知识">
<meta property="og:url" content="https://winjeg.github.io/2016/04/13/storage/mysql/master_slave/index.html">
<meta property="og:site_name" content="winjeg&#39;s blog">
<meta property="og:description" content="同步时mysql -&gt; backup  123456mkdir -p &#x2F;backup&#x2F;mysqltar -izxvf &#x2F;backup&#x2F;hins1851643_data_20170301022021.tar.gz -C &#x2F;backup&#x2F;mysql&#x2F;cp &#x2F;home&#x2F;wenwen&#x2F;backup-my.cnf &#x2F;backup&#x2F;mysql&#x2F;backup-my.cnfinnobackupex --us">
<meta property="og:locale">
<meta property="article:published_time" content="2016-04-13T15:14:11.000Z">
<meta property="article:modified_time" content="2022-12-05T15:06:01.889Z">
<meta property="article:author" content="winjeg">
<meta property="article:tag" content="database">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">

    
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon"><meta name="baidu-site-verification" content="5fNkcnppPy">

    
<link rel="stylesheet" href="/css/common.min.css">



    
    
    
    
        <link href="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css" rel="stylesheet">
    
    
    
<link rel="stylesheet" href="/css/iconfont.min.css">

    
<meta name="generator" content="Hexo 6.3.0"></head>

    <body>
        <header class="header header-fixture">
    <div class="profile-search-wrap flex sm:block">
        
        
        <div class="profile sm:text-center md:px-1 lg:px-3 sm:pb-4 sm:pt-6">
            <a id="avatar" role="link" href="https://github.com/winjeg" class="inline-block lg:w-16 lg:h-16 w-8 h-8 m-2" target="_blank" rel="noopener" rel="noreferrer" >
                <img src="https://www.gravatar.com/avatar/430f1fc50c046af01cd65a76639a2218?s=128" class="rounded-full" alt="avatar">
            </a>
            <h2 id="name" class="hidden lg:block">winjeg</h2>
            <h3 id="title" class="hidden lg:block">Architect &amp; Coder</h3>
            
            <small id="location" class="hidden lg:block">
                <i class="iconfont icon-map-icon"></i>
                Hangzhou, China
            </small>
            
        </div>
        
        
<div class="search flex-1 flex lg:inline-block sm:hidden lg:px-4 lg:mt-2 lg:mb-4 lg:w-full">
    <form id="search-form" class="my-auto flex-1 lg:border lg:border-solid lg:border-gray-200">
        <div class="input-group table bg-gray-100 lg:bg-white w-full">
            <input id="search-input" type="text" placeholder="Search" class="inline-block w-full bg-gray-100 lg:bg-white p-1">
            <span class="table-cell">
                <button name="search tigger button" disabled>
                    <i class="iconfont icon-search m-2"></i>
                </button>
            </span>
        </div>
    </form>
        
<div id="content-json" data-placeholder="Search" class="invisible hidden">/content.json</div>
<script id="search-teamplate" type="text/html" data-path="/content.json">
    <div>
        <div class="search-header bg-gray-400">
            <input id="actual-search-input" model="keyword" ref="input" class="inline-block w-full h-10 px-2 py-1" placeholder="Search" type="text">
        </div>
        <div class="search-result bg-gray-200">
            {{#each searchPosts}}
            <a href="/{{ path }}" class="result-item block px-2 pb-3 mb-1 pt-1 hover:bg-indigo-100">
                <i class="iconfont icon-file"></i>
                <h1 class="result-title inline font-medium text-lg">{{ title }}</h1>
                <p class="result-content text-gray-600 text-sm">{{{ text }}}</p>
            </a>
            {{/each}}
        </div>
    </div>
</script>

</div>


        <button name="menu toogle button" id="menu-toggle-btn" class="block sm:hidden p-3" role="button" aria-expanded="false">
            <i class="iconfont icon-hamburger"></i>
        </button>
    </div>
    <nav id="menu-nav" class="hidden sm:flex flex-col">
        
        
            <div class="menu-item menu-home" role="menuitem">
                <a href="/.">
                    <i class="iconfont icon-home" aria-hidden="true"></i>
                    <span class="menu-title">Home</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-archives" role="menuitem">
                <a href="/archives">
                    <i class="iconfont icon-archive" aria-hidden="true"></i>
                    <span class="menu-title">Archives</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-categories" role="menuitem">
                <a href="/categories">
                    <i class="iconfont icon-folder" aria-hidden="true"></i>
                    <span class="menu-title">Categories</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-tags" role="menuitem">
                <a href="/tags">
                    <i class="iconfont icon-tag" aria-hidden="true"></i>
                    <span class="menu-title">Tags</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-repository" role="menuitem">
                <a href="/repository">
                    <i class="iconfont icon-project" aria-hidden="true"></i>
                    <span class="menu-title">Repository</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-links" role="menuitem">
                <a href="/links">
                    <i class="iconfont icon-friend" aria-hidden="true"></i>
                    <span class="menu-title">Links</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-about" role="menuitem">
                <a href="/about">
                    <i class="iconfont icon-cup" aria-hidden="true"></i>
                    <span class="menu-title">About</span>
                </a>
            </div>
        
        
<div class="social-links flex sm:flex-col lg:hidden mt-5">
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://github.com/winjeg">
                <i class="iconfont social-icon icon-github"></i>
                <span class="menu-title hidden lg:inline">menu.github</span>
            </a>
        </span>
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://t.me/winjeg">
                <i class="iconfont social-icon icon-telegram"></i>
                <span class="menu-title hidden lg:inline">menu.telegram</span>
            </a>
        </span>
    
        <span class="social-item text-center">
            <a target="_blank" rel="noopener" href="https://twitter.com/winjeg">
                <i class="iconfont social-icon icon-twitter"></i>
                <span class="menu-title hidden lg:inline">menu.twitter</span>
            </a>
        </span>
    
        <span class="social-item text-center">
            <a href="/atom.xml">
                <i class="iconfont social-icon icon-rss"></i>
                <span class="menu-title hidden lg:inline">menu.rss</span>
            </a>
        </span>
    
</div>


    </nav>
</header>

        <section class="main-section">
            
    <main class="flex-1 px-4 py-14 md:px-5 lg:px-8 lg:py-4 relative min-h-screen">
    

    <article class="content article article-archives article-type-list" itemscope="">
        <header class="article-header">
            
    
        <h1 class="article-title text-lg" itemprop="name">
            Mysql 主从同步相关的知识
        </h1>
    



            <p class="article-meta mb-3 text-xs">
                <span class="article-date">
    <i class="iconfont icon-calendar-check"></i>
	<a href="/2016/04/13/storage/mysql/master_slave/" class="article-date">
	  <time datetime="2016-04-13T15:14:11.000Z" itemprop="datePublished">Apr 13</time>
	</a>
</span>

                
    <span class="article-category">
    <i class="iconfont icon-folder"></i>
    <a class="article-category-link" href="/categories/storage/">storage</a> , <a class="article-category-link" href="/categories/storage/database/">database</a>
  </span>


                
    <span class="article-tags">
    <i class="iconfont icon-tag"></i>
    <a class="article-tag-none-link" href="/tags/MySQL/" rel="tag">MySQL</a>, <a class="article-tag-none-link" href="/tags/database/" rel="tag">database</a>
  </span>


                <span class="_partial/post-comment"><i class="icon icon-comment"></i>
                    <a href="/2016/04/13/storage/mysql/master_slave/#comments" class="article-comment-link">
                        Comments
                    </a>
                </span>
                

            </p>
        </header>
        <div class="marked-body article-body">
            <p>同步时mysql -&gt; backup </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /backup/mysql</span><br><span class="line">tar -izxvf /backup/hins1851643_data_20170301022021.tar.gz -C /backup/mysql/</span><br><span class="line"><span class="built_in">cp</span> /home/wenwen/backup-my.cnf /backup/mysql/backup-my.cnf</span><br><span class="line">innobackupex --user=root --password --defaults-file=/etc/mysql/my.cnf --apply-log /backup/mysql</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /var/lib/mysql</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /backup/mysql</span><br></pre></td></tr></table></figure>
<p>replicate.conf</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">server-id</span>       = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## same on the slave</span></span><br><span class="line"><span class="attr">log-bin</span>         = mysql-bin</span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span>=<span class="number">512</span>M</span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span>  = <span class="number">1</span></span><br><span class="line"><span class="attr">sql_mode</span>=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"><span class="attr">log_bin_trust_function_creators</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sync_binlog</span>     = <span class="number">1</span></span><br><span class="line"><span class="comment">#binlog-format=&#x27;ROW&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">relay-log</span>=mysqld-relay-bin</span><br><span class="line"></span><br><span class="line"><span class="attr">read_only</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">master-info-repository</span>=file</span><br><span class="line"><span class="attr">relay-log-info_repository</span>=file</span><br><span class="line"><span class="attr">binlog-format</span>=ROW</span><br><span class="line"><span class="attr">innodb_checksum_algorithm</span>=innodb</span><br><span class="line"><span class="attr">innodb_data_file_path</span>=ibdata1:<span class="number">200</span>M:autoextend</span><br><span class="line"><span class="attr">innodb_log_files_in_group</span>=<span class="number">2</span></span><br><span class="line"><span class="attr">innodb_log_file_size</span>=<span class="number">524288000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#relay_log_info_repository = TABLE</span></span><br><span class="line"><span class="comment">#master_info_repository    = TABLE</span></span><br><span class="line"><span class="attr">relay_log_recovery</span>        = <span class="literal">on</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### replicate settings</span></span><br><span class="line"><span class="attr">replicate-ignore-db</span>=performance_schema</span><br><span class="line"><span class="attr">replicate-ignore-db</span>=mysql</span><br><span class="line"><span class="attr">replicate-do-db</span>=fenshua123</span><br><span class="line"><span class="comment">#replicate-rewrite-db=&quot;maindata-&gt;diydata&quot;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span> MASTER_HOST<span class="operator">=</span><span class="string">&#x27;10.1.8.160&#x27;</span>, MASTER_USER<span class="operator">=</span><span class="string">&#x27;rdsinner&#x27;</span>,  MASTER_PORT <span class="operator">=</span> <span class="number">3306</span>, MASTER_LOG_POS<span class="operator">=</span><span class="number">120</span>, MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;the_password&#x27;</span>, MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.002458&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="主从同步"><a href="#主从同步" class="headerlink" title="主从同步"></a>主从同步</h2><ol>
<li>SLAVE  切换命令： CHANGE MASTER TO MASTER_HOST&#x3D;’10.1.6.111’, MASTER_USER&#x3D;’fenshuaprod’, MASTER_LOG_POS&#x3D;120, MASTER_PASSWORD&#x3D;’TUzu4515’, MASTER_LOG_FILE&#x3D;’mysql-bin.000001’, relay-log&#x3D;mysqld-relay-bin;</li>
<li>Master 重启在先， Slave重启在后，即可保持复制关系， 如果Slave 重启在先， 则需要在Slave 上手动 start slave；才可以维持复制关系</li>
<li>MySql 支持引入其他配置文件， 用 !include &#x2F;filepath 即可，但注意引入的文件要标明在那个section 下面，否则很容易就会抛异常<br>4.检查relay_log_info_repository是否修改成功。<br> show variables where variable_name in  (‘relay_log_info_repository’,’master_info_repository’);</li>
<li>设置表只读 lock table t_depart_info read;  </li>
<li>设置表名忽略大小写 lower_case_table_names&#x3D;1</li>
<li>设置库只读read-only</li>
<li>sudo innobackupex –user&#x3D;root –password –defaults-file&#x3D;&#x2F;data&#x2F;backup-my.cnf –tables-file&#x3D;&#x2F;data&#x2F;site.cnf –ibbackup&#x3D;xtrabackup_56 –apply-log &#x2F;data&#x2F;mysql</li>
</ol>
<p>1．在ECS服务器上安装MySQL，详细步骤可以参考如下：<br><a target="_blank" rel="noopener" href="http://www.centoscn.com/mysql/2014/0924/3833.html">http://www.centoscn.com/mysql/2014/0924/3833.html</a><br>一些关键注意点：<br>a.数据库的版本至少为5.6.16及以上<br>b.需要在my.cnf中配置的一些关键参数：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server-id <span class="comment">###Slave配置需要</span></span><br><span class="line"><span class="attr">master-info-repository</span>=file<span class="comment">### Slave配置需要</span></span><br><span class="line"><span class="attr">relay-log-info_repository</span>=file<span class="comment">### Slave配置需要</span></span><br><span class="line"><span class="attr">binlog-format</span>=ROW<span class="comment">### Slave配置需要</span></span><br><span class="line"><span class="attr">gtid-mode</span>=<span class="literal">on</span><span class="comment">###开启GTID需要</span></span><br><span class="line"><span class="attr">enforce-gtid-consistency</span>=<span class="literal">true</span><span class="comment">###开启GTID需要</span></span><br><span class="line"><span class="attr">innodb_data_file_path</span>=ibdata1:<span class="number">200</span>M:autoextend<span class="comment">###使用RDS的物理备份中的backup-my.cnf参数</span></span><br><span class="line"><span class="attr">innodb_log_files_in_group</span>=<span class="number">2</span><span class="comment">###使用RDS的物理备份中的backup-my.cnf参数</span></span><br><span class="line"><span class="attr">innodb_log_file_size</span>=<span class="number">524288000</span><span class="comment">###使用RDS的物理备份中的backup-my.cnf参数</span></span><br></pre></td></tr></table></figure>
<p>2.MySQL安装好后，可以使用RDS提供的物理备份文件恢复到本地MySQL中，可以参考：<br><a target="_blank" rel="noopener" href="http://help.aliyun.com/knowledge_detail/5973700.html?spm=5176.7114037.1996646101.1.7qe3ot&amp;pos=1">http://help.aliyun.com/knowledge_detail/5973700.html?spm=5176.7114037.1996646101.1.7qe3ot&amp;pos=1</a><br>注意：<br>需要将备份解压后的文件backup-my.cnf中的三个参数加到启动文件中去</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">innodb_checksum_algorithm</span>=innodb</span><br><span class="line"><span class="attr">innodb_data_file_path</span>=ibdata1:<span class="number">200</span>M:autoextend</span><br><span class="line"><span class="attr">innodb_log_files_in_group</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>3.数据库启动后，开始设置本地数据库与RDS的同步关系<br>a．reset slave;####用于重置本地MySQL的复制关系，这一步操作有可能报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; reset slave;</span><br><span class="line">ERROR 1794 (HY000): Slave is not configured or failed to initialize properly. You must at least set –server-id to enable either a master or a slave. Additional error messages can be found in the MySQL error log.</span><br></pre></td></tr></table></figure>
<p>原因是由于RDS的备份文件中包含了RDS的主从复制关系，需要把这些主从复制关系清理掉，清理方法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span>  slave_relay_log_info;</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span>  mysql.slave_master_info;</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span>  mysql.slave_worker_info;</span><br></pre></td></tr></table></figure>
<p>然后重启MySQL；<br>b.SET @@GLOBAL.GTID_PURGED<br>&#x3D;’818795a2-8aa8-11e5-95b1:1-289,8da7b8ab-8aa8-11e5-95b1:1-75′;<br>打开备份解压文件可以看到文件xtrabackup_slave_info，其中第一行就是我们需要在本地MySQL执行的命令，他表示在备份结束时刻RDS当前GTID值’<br>c.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span></span><br><span class="line">master_host<span class="operator">=</span>’gtid1.mysql.rds.aliyuncs.com’,</span><br><span class="line">master_user<span class="operator">=</span>’qianyi’,master_port<span class="operator">=</span><span class="number">3306</span>,master_password<span class="operator">=</span>’qianyi’,</span><br><span class="line">master_auto_position<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>设置本地MySQL与RDS的复制关系，账户qianyi是在RDS控制系统中添加（注意：<br>同步账户不要以repl开头）；<br>4．测试同步关系是否正常，可以在本地MySQL执行show slave status\G查看同步状态，同时可以在RDS中插入测试一些数据，或者重启实例，观察同步情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">Slave_IO_State: Queueing master event to the relay log</span><br><span class="line">Master_Host: gtid1.mysql.rds.aliyuncs.com</span><br><span class="line">Master_User: qianyi</span><br><span class="line">Master_Port: 3306</span><br><span class="line">Connect_Retry: 60</span><br><span class="line">Master_Log_File: mysql-bin.000007</span><br><span class="line">Read_Master_Log_Pos: 625757</span><br><span class="line">Relay_Log_File: slave-relay.000002</span><br><span class="line">Relay_Log_Pos: 2793</span><br><span class="line">Relay_Master_Log_File: mysql-bin.000007</span><br><span class="line">                Slave_IO_Running: Yes</span><br><span class="line">                Slave_SQL_Running: Yes</span><br><span class="line">Exec_Master_Log_Pos: 612921</span><br><span class="line">Relay_Log_Space: 15829</span><br><span class="line">       Seconds_Behind_Master: 57133</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">Master_Server_Id: 2319282016</span><br><span class="line">Master_UUID: 818795a2-8aa8-11e5-95b1-6c92bf20cfcf</span><br><span class="line">Master_Info_File: /data/work/mysql/data3001/mysql/master.info</span><br><span class="line">SQL_Delay: 0</span><br><span class="line">SQL_Remaining_Delay: NULL</span><br><span class="line">Slave_SQL_Running_State: Reading event from the relay log</span><br><span class="line">Master_Retry_Count: 86400</span><br><span class="line">818795a2-8aa8-11e5-95b1-6c92bf20cfcf:17754-17811</span><br><span class="line">Executed_Gtid_Set: 818795a2-8aa8-11e5-95b1-6c92bf20cfcf:1-17761</span><br><span class="line">Auto_Position: 1</span><br></pre></td></tr></table></figure>
<p>5.做好监控，由于采用MySQL的原生复制，所以可能会导致本地MySQL与RDS的复制出现中断，可以定时去探测  Slave_IO_Running和 Slave_SQL_Running两个状态值是否为yes，同时也需要关注本地MySQL与RDS的延迟： Seconds_Behind_Master。</p>
<p>删除slave_worker_info内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global sync_binlog=20 ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; set global innodb_flush_log_at_trx_commit=2;Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">innodb_flush_log_at_trx_commit</span><br></pre></td></tr></table></figure>
<p>如果innodb_flush_log_at_trx_commit设置为0，log buffer将每秒一次地写入log file中，并且log file的flush(刷到磁盘)操作同时进行.该模式下，在事务提交的时候，不会主动触发写入磁盘的操作。<br>如果innodb_flush_log_at_trx_commit设置为1，每次事务提交时MySQL都会把log buffer的数据写入log file，并且flush(刷到磁盘)中去.<br>如果innodb_flush_log_at_trx_commit设置为2，每次事务提交时MySQL都会把log buffer的数据写入log file.但是flush(刷到磁盘)操作并不会同时进行。该模式下,MySQL会每秒执行一次 flush(刷到磁盘)操作。<br>注意：<br>由于进程调度策略问题,这个“每秒执行一次 flush(刷到磁盘)操作”并不是保证100%的“每秒”。<br>sync_binlog<br>sync_binlog 的默认值是0，像操作系统刷其他文件的机制一样，MySQL不会同步到磁盘中去而是依赖操作系统来刷新binary log。<br>当sync_binlog &#x3D;N (N&gt;0) ，MySQL 在每写 N次 二进制日志binary log时，会使用fdatasync()函数将它的写二进制日志binary log同步到磁盘中去。<br>注意:<br>如果启用了autocommit，那么每一个语句statement就会有一次写操作；否则每个事务对应一个写操作。<br>而且mysql服务默认是autocommit打开的<br>修改参数后，slave2,3也一样可以跟上slave1的速度了</p>

        </div>
        
<blockquote class="copyright">
    <p><strong>Link to this article : </strong><a class="permalink" href="https://winjeg.github.io/2016/04/13/storage/mysql/master_slave/">https://winjeg.github.io/2016/04/13/storage/mysql/master_slave/</a></p>
    <p><strong>All rights reserved to winjeg</strong></p>
</blockquote>


    </article>
    
    <section id="comments">
        
    </section>


    

</main>


<aside style="" id="sidebar" class="aside aside-fixture">
    <div class="toc-sidebar">
        <nav id="toc" class="article-toc">
            <h3 class="toc-title">Catalogue</h3>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5"><span class="toc-number">1.</span> <span class="toc-text">主从同步</span></a></li></ol>
        </nav>
    </div>
</aside>





        </section>
        <footer class="hidden lg:block fixed bottom-0 left-0 sm:w-1/12 lg:w-1/6 bg-gray-100 z-40">
    
    <div class="footer-social-links">
        
            <a target="_blank" rel="noopener" href="https://github.com/winjeg">
                <i class="iconfont icon-github"></i>
            </a>
        
            <a target="_blank" rel="noopener" href="https://t.me/winjeg">
                <i class="iconfont icon-telegram"></i>
            </a>
        
            <a target="_blank" rel="noopener" href="https://twitter.com/winjeg">
                <i class="iconfont icon-twitter"></i>
            </a>
        
            <a href="/atom.xml">
                <i class="iconfont icon-rss"></i>
            </a>
        
    </div>
    
    
</footer>

        <div id="mask" class="hidden mask fixed inset-0 bg-gray-900 opacity-75 z-40"></div>
        <div id="search-view-container" class="hidden shadow-xl"></div>
        
<script src="/js/dom-event.min.js"></script>



<script src="/js/local-search.min.js"></script>



    <script src="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/js/lightgallery.min.js"></script>
    
<script src="/js/light-gallery.min.js"></script>






    </body>
</html>
