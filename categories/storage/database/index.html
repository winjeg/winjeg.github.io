<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>分类: database - 节哥的博客</title><meta description="技术博客，主要用于记录自己平时所学的一些笔记"><meta property="og:type" content="blog"><meta property="og:title" content="节哥的博客"><meta property="og:url" content="https://winjeg.github.io/"><meta property="og:site_name" content="节哥的博客"><meta property="og:description" content="技术博客，主要用于记录自己平时所学的一些笔记"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://winjeg.github.io/img/og_image.png"><meta property="article:author" content="winjeg"><meta property="article:tag" content="golang"><meta property="article:tag" content=" java"><meta property="article:tag" content=" mysql"><meta property="article:tag" content=" devops"><meta property="article:tag" content=" linux"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://winjeg.github.io"},"headline":"节哥的博客","image":["https://winjeg.github.io/img/og_image.png"],"author":{"@type":"Person","name":"winjeg"},"description":"技术博客，主要用于记录自己平时所学的一些笔记"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?89dca33903eb0fe3c058e7875e7861b0";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="节哥的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">时间线</a><a class="navbar-item" href="/categories">文章分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Follow me on github" href="https://github.com/winjeg"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li><a href="/categories/storage/">storage</a></li><li class="is-active"><a href="#" aria-current="page">database</a></li></ul></nav></div></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2019/07/02/storage/mysql/mysql_docker/"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59422808-880b5180-8e03-11e9-9dfe-ff8a9a024be7.png" alt="使用docker运行MySQL服务"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-07-02T07:14:11.000Z" title="2019-07-02T07:14:11.000Z">2019-07-02</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">4 分钟 读完 (大约 655 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/07/02/storage/mysql/mysql_docker/">使用docker运行MySQL服务</a></h1><div class="content"><h2 id="为啥要使用docker运行MySQL"><a href="#为啥要使用docker运行MySQL" class="headerlink" title="为啥要使用docker运行MySQL"></a>为啥要使用docker运行MySQL</h2><p>熟悉docker和k8s的人都知道， 我们使用容器化技术，是为了方便我们运行某个服务，我们用docker 运行Mysql， 并不是因为mysql在docker比在物理机或者kvm上运行的更好，配置起来更简单。<br>我们使用docker 主要还是因为，我们在不关注太多MySQL本身的东西的时候， 单纯想快速简单的启动一个MySQL服务的时候能够做到，分钟级别即可完成。<br>这相对于传统级别的从安装到配置动则半小时到几个小时的工作量来说，已经非常简单方便了。</p>
<h2 id="怎么使用Docker-去运行一个MySQL服务"><a href="#怎么使用Docker-去运行一个MySQL服务" class="headerlink" title="怎么使用Docker 去运行一个MySQL服务"></a>怎么使用Docker 去运行一个MySQL服务</h2><p>在运行之前，你首先要装docker， 安装docker非常简单，只需要一路下一步下一步就可以完成， linux或者mac野只需要一些安装命令即可搞定。<br>当然安装docker可以不仅仅用于MySQL用途， 也可以用来它方便其他任何你想需要运行的服务的部署和运行。  </p>
<h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.6</span><br></pre></td></tr></table></figure>
<p>这里mysql是镜像名称， 5.6 是mysql的版本。 一半这些镜像都默认是比较官方维护的， 在docker没有进行特殊设置的情况下可以信任。</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql -v /opt/docker_v/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 -d imageID</span><br></pre></td></tr></table></figure>
<p>上述命令有如下解释：</p>
<ol>
<li><code>-p 3306:3306</code> 是指把容器的3306端口映射到本地的3306端口</li>
<li><code>--name</code> 制定容器的名称, 我们下次要操作的时候可以制定名称即可， 如 <code>docker start mysql</code></li>
<li><code>-v</code> 把本地文件夹与docker文件夹进行一个映射</li>
<li><code>-e</code> 传入容器一些环境变量， 这里传入的是MySQL运行的时候需要的root密码</li>
<li><code>-d</code> 后台方式运行</li>
</ol>
<h3 id="常见的问题"><a href="#常见的问题" class="headerlink" title="常见的问题"></a>常见的问题</h3><ol>
<li>docker 守护进程没有开启<br> 解决方案： 开启docker后台进程 如 <code>service docker start</code>或者 <code>systemctl start docker.service</code></li>
<li>mysql 运行的端口过小导致的没有权限<br> 解决方案：请在大于1024 的端口上运行MySQL</li>
<li>系统环境是 Windows 10 Pro，Docker 版本 18.03.1-ce，电脑开机之后第一次运行 docker run 的时候会遇到这个错误</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Docker\Docker\Resources\bin\docker.exe: Error response from daemon: driver failed programming external connectivity on endpoint app (36577729ce7d4d2dddefb7fddd32521ea66958cf824138804b02ffb3c98452f3): Error starting userland proxy: mkdir &#x2F;port&#x2F;tcp:0.0.0.0:3306:tcp:172.17.0.2:3306</span><br><span class="line">: input&#x2F;output error.</span><br></pre></td></tr></table></figure>

<p>解决方案： 重启docker服务</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2019/05/13/storage/mysql/passwd/"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59422808-880b5180-8e03-11e9-9dfe-ff8a9a024be7.png" alt="Mysql 如何找回Root密码"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-13T07:14:11.000Z" title="2019-05-13T07:14:11.000Z">2019-05-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">几秒 读完 (大约 74 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/05/13/storage/mysql/passwd/">Mysql 如何找回Root密码</a></h1><div class="content"><h2 id="1-修改-etc-my-cnf"><a href="#1-修改-etc-my-cnf" class="headerlink" title="1  修改 /etc/my.cnf"></a>1  修改 /etc/my.cnf</h2><p>加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>

<h2 id="2-重启mysql"><a href="#2-重启mysql" class="headerlink" title="2. 重启mysql"></a>2. 重启mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<h2 id="3-更改root密码"><a href="#3-更改root密码" class="headerlink" title="3. 更改root密码"></a>3. 更改root密码</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql ; </span><br><span class="line">mysql&gt; UPDATE user SET Password = password ( 'new-password' ) WHERE User = 'root' ; </span><br><span class="line">mysql&gt; flush privileges ; </span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure>
<p>如果版本高于5.6 则是如下字段存着密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authentication_string</span><br></pre></td></tr></table></figure>
<h2 id="4-将MySQL的登录设置修改回来"><a href="#4-将MySQL的登录设置修改回来" class="headerlink" title="4.将MySQL的登录设置修改回来"></a>4.将MySQL的登录设置修改回来</h2><h2 id="5-重启mysql"><a href="#5-重启mysql" class="headerlink" title="5. 重启mysql"></a>5. 重启mysql</h2></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2019/05/13/storage/mysql/mysql_other/"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59422808-880b5180-8e03-11e9-9dfe-ff8a9a024be7.png" alt="Mysql 其他杂记"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-13T07:14:11.000Z" title="2019-05-13T07:14:11.000Z">2019-05-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">4 分钟 读完 (大约 601 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/05/13/storage/mysql/mysql_other/">Mysql 其他杂记</a></h1><div class="content"><h2 id="事务查询"><a href="#事务查询" class="headerlink" title="事务查询"></a>事务查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @@tx_isolation</span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  r.<span class="string">`trx_id`</span> waiting_trx_id,</span><br><span class="line">  r.<span class="string">`trx_mysql_thread_id`</span> waiting_thread,</span><br><span class="line">  r.<span class="string">`trx_query`</span> waiting_query,</span><br><span class="line">  b.<span class="string">`trx_id`</span> bolcking_trx_id,</span><br><span class="line">  b.<span class="string">`trx_mysql_thread_id`</span> blocking_thread,</span><br><span class="line">  b.<span class="string">`trx_query`</span> block_query </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  information_schema.<span class="string">`INNODB_LOCK_WAITS`</span> w </span><br><span class="line">  <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.<span class="string">`INNODB_TRX`</span> b </span><br><span class="line">    <span class="keyword">ON</span> b.<span class="string">`trx_id`</span> = w.<span class="string">`blocking_trx_id`</span> </span><br><span class="line">  <span class="keyword">INNER</span> <span class="keyword">JOIN</span> information_schema.<span class="string">`INNODB_TRX`</span> r </span><br><span class="line">    <span class="keyword">ON</span> r.<span class="string">`trx_id`</span> = w.<span class="string">`requesting_trx_id`</span> ;</span><br></pre></td></tr></table></figure>
<h2 id="查询外键"><a href="#查询外键" class="headerlink" title="查询外键"></a>查询外键</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">'alter table '</span>,table_name,<span class="string">' drop foreign key '</span>,constraint_name,<span class="string">';'</span>) </span><br><span class="line"><span class="keyword">from</span> information_schema.key_column_usage</span><br><span class="line"><span class="keyword">where</span> constraint_schema = <span class="string">'dbname'</span> <span class="keyword">and</span> referenced_table_name = <span class="string">'tbName'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">concat</span>(<span class="string">'alter table '</span>,table_schema,<span class="string">'.'</span>,table_name,<span class="string">' DROP FOREIGN KEY '</span>,constraint_name,<span class="string">';'</span>)</span><br><span class="line"><span class="keyword">FROM</span> information_schema.table_constraints</span><br><span class="line"><span class="keyword">WHERE</span> constraint_type=<span class="string">'FOREIGN KEY'</span></span><br><span class="line"><span class="keyword">AND</span> table_schema=<span class="string">'dbname'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> information_schema.<span class="string">`TABLES`</span></span><br><span class="line"><span class="keyword">WHERE</span> TABLE_TYPE=<span class="string">"BASE TABLE"</span></span><br><span class="line"><span class="keyword">AND</span> TABLE_SCHEMA=<span class="string">"dbname"</span></span><br></pre></td></tr></table></figure>

<p>原因是由于RDS的备份文件中包含了RDS的主从复制关系，需要把这些主从复制关系清理掉，清理方法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span>  slave_relay_log_info;</span><br><span class="line"></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span>  mysql.slave_master_info;</span><br></pre></td></tr></table></figure>


<h3 id="Mysql-DUMP-表"><a href="#Mysql-DUMP-表" class="headerlink" title="Mysql DUMP 表"></a>Mysql DUMP 表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -h 127.0.0.1  dbName msgattach  &gt; msgattach.sql</span><br></pre></td></tr></table></figure>


<h3 id="MySQL-客户端"><a href="#MySQL-客户端" class="headerlink" title="MySQL 客户端"></a>MySQL 客户端</h3><p>从表现上来看分两种：</p>
<ol>
<li>客户端执行完query之后， 直接返回， 并开始用rows.next 去取数据， 其中很快</li>
<li>如果在客户端取数据的时候打上断点， 服务端发送完数据之后， 客户端只能取到部分数据， 不能取到全部数据， 怀疑客户端有一个缓冲区，不断接收服务端的数据并刷新</li>
<li>如果客户端收到数据后，不打断点， 则可以获取全部数据（前提是建立在客户端执行速度比较快的情况下）</li>
</ol>
<p>底层代码里面来看， mysql服务端发送数据给客户端的时候， 客户端会把数据存在一个 默认4096大小的buffer 里面， 从这个buffer里面再读到rows里面<br>如果buffer里的数据没有被及时消费掉， 那么连接上面传送过来的数据会丢失掉。</p>
<p>MySQL 本身的问题对于数据量传输不完的时候有个write_timeout,  出现错误之后， 会返回EOF 相关的Error</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysql] 2019&#x2F;04&#x2F;25 14:31:27 packets.go:72: unexpected EOF</span><br><span class="line">[mysql] 2019&#x2F;04&#x2F;25 14:31:27 packets.go:393: busy buffer</span><br></pre></td></tr></table></figure>


<h3 id="实用脚本"><a href="#实用脚本" class="headerlink" title="实用脚本"></a>实用脚本</h3><h4 id="Mysql-查看表的外键"><a href="#Mysql-查看表的外键" class="headerlink" title="Mysql 查看表的外键"></a>Mysql 查看表的外键</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME </span><br><span class="line"><span class="keyword">from</span> INFORMATION_SCHEMA.KEY_COLUMN_USAGE </span><br><span class="line"> <span class="keyword">WHERE</span> CONSTRAINT_NAME != <span class="string">'PRIMARY'</span> <span class="keyword">AND</span> REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<h4 id="测试稳定情况"><a href="#测试稳定情况" class="headerlink" title="测试稳定情况"></a>测试稳定情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 100`; <span class="keyword">do</span> </span><br><span class="line">    mysql -u username -h host -P 3306 -ppassword -e <span class="string">"use dbName; select askid from ask limit 1"</span>; <span class="built_in">echo</span> <span class="string">"==============<span class="variable">$i</span>"</span>; sleep 1;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-11-13T07:14:11.000Z" title="2018-11-13T07:14:11.000Z">2018-11-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">18 分钟 读完 (大约 2655 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/11/13/storage/redis/mem_analysis/">redis 内存分析工具 `rma4go`</a></h1><div class="content"><h2 id="redis-简介"><a href="#redis-简介" class="headerlink" title="redis 简介"></a>redis 简介</h2><p>redis是一个很有名的内存型数据库，这里不做详细介绍。而<code>rma4go</code> (redis memory analyzer for golang) 是一个redis的内存分析工具，这个工具的主要作用是针对运行时期的redis进行内存的分析，统计redis中key的分布情况， 各种数据类型的使用情况，key的size，大key的数量及分布, key的过期状况分布等一些有助于定位redis使用问题的工具，希望这能够给应用开发者提供便利排查生产中所遇到的实际问题。</p>
<h2 id="rma4go的应用场景"><a href="#rma4go的应用场景" class="headerlink" title="rma4go的应用场景"></a><code>rma4go</code>的应用场景</h2><p>redis是目前很流行的一个内存型数据库，很多企业都在使用。 但由于业界并没有很多对于redis使用上的规范，或者是有一些规范并没有被很好的遵循， 存在很多redis使用上的问题，我这边就列举一些例子：</p>
<ol>
<li>redis 存用满了, 不知道key的分布情况，不知道来源于那个应用</li>
<li>redis 被block了，不知道什么原因导致的block，是哪个应用里的什么key的操作导致的</li>
<li>想迁移redis数据，或者调整一些设置，但不知道要不要对redis里的数据进行保留，以及不知道什么业务在使用等</li>
<li>redis的key的过期情况不明朗， 不知道哪些东西可以删除或者调整<br>其实上面的一些问题是我随便列举出来的一些，并不是所有的存在的问题，相信也有很多其他场景同样会用到这样的一个redis内存分析工具<code>rma4go</code></li>
</ol>
<h2 id="rma4go的具体功能"><a href="#rma4go的具体功能" class="headerlink" title="rma4go的具体功能"></a>rma4go的具体功能</h2><h3 id="数据维度"><a href="#数据维度" class="headerlink" title="数据维度"></a>数据维度</h3><p>对于key的分析我们这个工具会提供如下几个维度的数据：</p>
<ul>
<li>key的数量分布维度</li>
<li>key的过期分布维度</li>
<li>key的类型分布维度</li>
<li>key对应的的数据的大小分布维度</li>
<li>key的前缀分布维度</li>
<li>慢key与大key的维度</li>
</ul>
<p>当然以后如果发现有更好的纬度也会添加进去，目前先以这几个纬度为主</p>
<h3 id="数据类型设计"><a href="#数据类型设计" class="headerlink" title="数据类型设计"></a>数据类型设计</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RedisStat <span class="keyword">struct</span> &#123;</span><br><span class="line">	All     KeyStat <span class="string">`json:"all"`</span></span><br><span class="line">	String  KeyStat <span class="string">`json:"string"`</span></span><br><span class="line">	Hash    KeyStat <span class="string">`json:"hash"`</span></span><br><span class="line">	Set     KeyStat <span class="string">`json:"set"`</span></span><br><span class="line">	List    KeyStat <span class="string">`json:"list"`</span></span><br><span class="line">	ZSet    KeyStat <span class="string">`json:"zset"`</span></span><br><span class="line">	Other   KeyStat <span class="string">`json:"other"`</span></span><br><span class="line">	BigKeys KeyStat <span class="string">`json:"bigKeys"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// distributions of keys of all prefixes</span></span><br><span class="line"><span class="keyword">type</span> Distribution <span class="keyword">struct</span> &#123;</span><br><span class="line">	KeyPattern <span class="keyword">string</span> <span class="string">`json:"pattern"`</span></span><br><span class="line">	Metrics</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// basic metrics of a group of key</span></span><br><span class="line"><span class="keyword">type</span> Metrics <span class="keyword">struct</span> &#123;</span><br><span class="line">	KeyCount       <span class="keyword">int64</span> <span class="string">`json:"keyCount"`</span></span><br><span class="line">	KeySize        <span class="keyword">int64</span> <span class="string">`json:"keySize"`</span></span><br><span class="line">	DataSize       <span class="keyword">int64</span> <span class="string">`json:"dataSize"`</span></span><br><span class="line">	KeyNeverExpire <span class="keyword">int64</span> <span class="string">`json:"neverExpire"`</span></span><br><span class="line">	ExpireInHour   <span class="keyword">int64</span> <span class="string">`json:"expireInHour"`</span>  <span class="comment">// &gt;= 0h &lt; 1h</span></span><br><span class="line">	ExpireInDay    <span class="keyword">int64</span> <span class="string">`json:"expireInDay"`</span>   <span class="comment">// &gt;= 1h &lt; 24h</span></span><br><span class="line">	ExpireInWeek   <span class="keyword">int64</span> <span class="string">`json:"expireInWeek"`</span>  <span class="comment">// &gt;= 1d &lt; 7d</span></span><br><span class="line">	ExpireOutWeek  <span class="keyword">int64</span> <span class="string">`json:"expireOutWeek"`</span> <span class="comment">// &gt;= 7d</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现细节"><a href="#实现细节" class="headerlink" title="实现细节"></a>实现细节</h3><h4 id="key元信息"><a href="#key元信息" class="headerlink" title="key元信息"></a>key元信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type KeyMeta struct &#123;</span><br><span class="line">	Key      string</span><br><span class="line">	KeySize  int64</span><br><span class="line">	DataSize int64</span><br><span class="line">	Ttl      int64</span><br><span class="line">	Type     string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>众所周知， redis里的所有的数据基本都是由key的， 也是根据key进行操作的，那么对redis里的key进行分析我们必须要记录下来这个key的信息才可以做到， 我们能记录的信息正如以上结构中的一样， key本身， key的大小， 数据的大小， 过期时间以及key的类型。这些信息是我们对key进行分析的一个基础信息，都可以通过一些简单的redis命令就可以取到。</p>
<h4 id="遍历redis所有key"><a href="#遍历redis所有key" class="headerlink" title="遍历redis所有key"></a>遍历redis所有key</h4><p>要对一个redis进行完整的key分析， 我们就需要有办法能够访问到所有key的源信息， 所幸redis提供了 <code>scan</code>这么一种方式可以比较轻量的遍历所有的key，访问到相应的key的元信息。<br>这样对于redis而言， 进行在线key分析的时候造成的压力也不会非常大，当然key分析不能再QPS高峰期进行， 需要在redis资源余量允许的情况下进行分析。</p>
<p>另外由于redis本身的一个内存清理机制，有25%的过期占用可以在分析key的时候被清理掉， 因此这个分析工具同时兼具了清理一部分内存的作用， 如果redis里面存在过期的而且存在于内存里面的key的话。</p>
<h4 id="对记录的信息进行分析与汇总"><a href="#对记录的信息进行分析与汇总" class="headerlink" title="对记录的信息进行分析与汇总"></a>对记录的信息进行分析与汇总</h4><p>有了遍历所有key的方法， 又有了元数据， 剩下的事情就是把这些数据进行聚合汇总， 这个主要是一个算法上的工作，<br>最难的部分要数这个key聚合的部分了， 这里面有很多取舍， 由于作者我本人不是专攻算法的， 而且没有找到合适的库， 因此只能动手自己想了一种方式。 基本的思路是：</p>
<h5 id="压缩的算法"><a href="#压缩的算法" class="headerlink" title="压缩的算法"></a>压缩的算法</h5><ol>
<li>对于每个新的key的元信息， 添加到老的key分析对象里去</li>
<li>对这个key从后往前缩短， 去除尾部，看是否已经包含这个key的统计信息，如果包含， 则把key的信息累加上去， 如果不包含则创建一个新的纪录。</li>
<li>当记录的个数添加到一定数量的时候， 对对象的个数进行一次压缩<ul>
<li>压缩的算法也是从字符串的末尾往字符串首部进行压缩</li>
<li>当压缩不能增加这个pattern 的key的个数的时候使用原来的key（压缩前的key）</li>
<li>当压缩可以增加这个pattern的key的个数的时候，进行key的合并，把pattern设置成压缩后的pattern</li>
<li>当记录的条数超过指定的条数就循环往复，直到压缩到小于指定的条数为止</li>
<li>如果对于key的最小长度（就算再压缩也要保留一两位）有要求， 有一些压缩到字符串的最小长度的参数可以进行调整与设置， 进行一定的取舍。</li>
</ul>
</li>
<li>直到scan完毕</li>
</ol>
<h5 id="代码如下"><a href="#代码如下" class="headerlink" title="代码如下"></a>代码如下</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	defaultSize = <span class="number">128</span></span><br><span class="line">	compactNum  = <span class="number">30</span></span><br><span class="line">	maxLeftNum =  <span class="number">150</span></span><br><span class="line">	minKeyLenLower = <span class="number">2</span></span><br><span class="line">	minKeyLen   = <span class="number">5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stat *KeyStat)</span> <span class="title">compact</span><span class="params">()</span></span> &#123;</span><br><span class="line">	distMap := stat.Distribution</span><br><span class="line">	tmpMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">string</span>, defaultSize)</span><br><span class="line">	shrinkTo := compactNum</span><br><span class="line">	<span class="keyword">for</span> k := <span class="keyword">range</span> distMap &#123;</span><br><span class="line">		compactedKey := k</span><br><span class="line">		<span class="keyword">if</span> orgks, ok := tmpMap[compactedKey]; ok &#123;</span><br><span class="line">			orgks = <span class="built_in">append</span>(orgks, k)</span><br><span class="line">			tmpMap[compactedKey] = orgks</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ks := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, defaultSize)</span><br><span class="line">			ks = <span class="built_in">append</span>(ks, k)</span><br><span class="line">			tmpMap[compactedKey] = ks</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	shrinkTo--</span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">len</span>(tmpMap) &gt; compactNum &amp;&amp; shrinkTo &gt;= minKeyLen) || (<span class="built_in">len</span>(tmpMap) &gt; maxLeftNum &amp;&amp; shrinkTo &gt;= minKeyLenLower) &#123;</span><br><span class="line">		tnMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">string</span>, defaultSize)</span><br><span class="line">		<span class="keyword">for</span> k := <span class="keyword">range</span> tmpMap &#123;</span><br><span class="line">			<span class="comment">// shrink</span></span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(k) &gt; shrinkTo &#123;</span><br><span class="line">				compactedKey := k[<span class="number">0</span>:shrinkTo]</span><br><span class="line">				<span class="keyword">if</span> oik, ok := tnMap[compactedKey]; ok &#123;</span><br><span class="line">					oik = <span class="built_in">append</span>(oik, tmpMap[k]...)</span><br><span class="line">					tnMap[compactedKey] = oik</span><br><span class="line"></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					ks := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, defaultSize)</span><br><span class="line">					ks = <span class="built_in">append</span>(ks, tmpMap[k]...)</span><br><span class="line">					tnMap[compactedKey] = ks</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				tnMap[k] = tmpMap[k]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果此次shrink 没有使得这个集合的元素数量增加， 就使用原来的key</span></span><br><span class="line">		<span class="keyword">for</span> k := <span class="keyword">range</span> tmpMap &#123;</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(k) &gt; shrinkTo &#123;</span><br><span class="line">				ck := k[<span class="number">0</span>:shrinkTo]</span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">len</span>(tnMap[ck]) == <span class="built_in">len</span>(tmpMap[k]) &amp;&amp; <span class="built_in">len</span>(tnMap[ck]) &gt; <span class="number">1</span> &#123;</span><br><span class="line">					x := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, defaultSize)</span><br><span class="line">					tnMap[k] = <span class="built_in">append</span>(x, tnMap[ck]...)</span><br><span class="line">					<span class="built_in">delete</span>(tnMap, ck)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		tmpMap = tnMap</span><br><span class="line">		shrinkTo --</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dists := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]Distribution, defaultSize)</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> tmpMap &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(v) &gt; <span class="number">1</span> &#123;</span><br><span class="line">			<span class="keyword">var</span> nd Distribution</span><br><span class="line">			<span class="keyword">for</span> _, dk := <span class="keyword">range</span> v &#123;</span><br><span class="line">				d := distMap[dk]</span><br><span class="line">				nd.KeyPattern = k + <span class="string">"*"</span></span><br><span class="line">				nd.KeyCount += d.KeyCount</span><br><span class="line">				nd.KeySize += d.KeySize</span><br><span class="line">				nd.DataSize += d.DataSize</span><br><span class="line">				nd.ExpireInHour += d.ExpireInHour</span><br><span class="line">				nd.ExpireInWeek += d.ExpireInWeek</span><br><span class="line">				nd.ExpireInDay += d.ExpireInDay</span><br><span class="line">				nd.ExpireOutWeek += d.ExpireOutWeek</span><br><span class="line">				nd.KeyNeverExpire += d.KeyNeverExpire</span><br><span class="line">			&#125;</span><br><span class="line">			dists[k] = nd</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> _, dk := <span class="keyword">range</span> v &#123;</span><br><span class="line">				nd := distMap[dk]</span><br><span class="line">				nd.KeyPattern = dk + <span class="string">"*"</span></span><br><span class="line">				dists[dk] = nd</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	stat.Distribution = dists</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="在线key分析的github项目"><a href="#在线key分析的github项目" class="headerlink" title="在线key分析的github项目"></a>在线key分析的github项目</h2><p><a href="https://github.com/winjeg/rma4go">rma4go</a><br>这是一个我已经写好的项目， 它使用起来非常简单</p>
<h3 id="构建方法"><a href="#构建方法" class="headerlink" title="构建方法"></a>构建方法</h3><ol>
<li>构建之前请确保golang sdk 已经安装， 并且版本 &gt;=1.11.0</li>
<li>请确保已经具备翻墙的环境， 因为它要下载一些依赖，可能来自墙外<br>翻墙方法如下<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// linux/osx</span><br><span class="line"><span class="built_in">export</span> http_proxy=somehost:port</span><br><span class="line"><span class="built_in">export</span> https_proxy=somehost:port</span><br><span class="line">// windows</span><br><span class="line"><span class="built_in">set</span> http_proxy=somehost:port</span><br><span class="line"><span class="built_in">set</span> https_proxy=somehost:port</span><br></pre></td></tr></table></figure></li>
<li>构建<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:winjeg&#x2F;rma4go.git</span><br><span class="line">cd rma4go</span><br><span class="line">go build .</span><br></pre></td></tr></table></figure>




</li>
</ol>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>用法如下：<code>rma4go -h</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rma4go usage:</span><br><span class="line">rma4go -r some_host -p 6379 -a password -d 0</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  -H string</span><br><span class="line">        address of a redis (default &quot;localhost&quot;)</span><br><span class="line">  -a string</span><br><span class="line">        password&#x2F;auth of the redis</span><br><span class="line">  -d int</span><br><span class="line">        db of the redis to analyze</span><br><span class="line">  -h    help content</span><br><span class="line">  -p int</span><br><span class="line">        port of the redis (default 6379)</span><br><span class="line">  -r string</span><br><span class="line">        address of a redis (default &quot;localhost&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="示例输出"><a href="#示例输出" class="headerlink" title="示例输出"></a>示例输出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">all keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">string keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">list keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">hash keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">set keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">zset keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">other keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br><span class="line">big keys statistics</span><br><span class="line"></span><br><span class="line">| PATTERN | KEY NUM | KEY SIZE | DATA SIZE | EXPIRE IN HOUR | EXPIRE IN DAY | EXPIRE IN WEEK | EXPIRE OUT WEEK | NEVER EXPIRE |</span><br><span class="line">|---------|---------|----------|-----------|----------------|---------------|----------------|-----------------|--------------|</span><br><span class="line">| total   |       0 |        0 |         0 |              0 |             0 |              0 |               0 |            0 |</span><br></pre></td></tr></table></figure>
<p>rendered by markdown<br>total count 4004</p>
<p>all keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>TOP_TEN_NEW_XXXXXXXX*</td>
<td>1</td>
<td>20</td>
<td>1529</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>XXXXXXXXXXXXXX_STATISTICS_MIGRATION_LIST*</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-root:*</td>
<td>23</td>
<td>272</td>
<td>299</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>23</td>
</tr>
<tr>
<td>DS_AXXXXXXXX_CORRECT*</td>
<td>2</td>
<td>45</td>
<td>46</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>time-2*</td>
<td>761</td>
<td>7528</td>
<td>9893</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>761</td>
</tr>
<tr>
<td>time-level:*</td>
<td>537</td>
<td>8461</td>
<td>6981</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>537</td>
</tr>
<tr>
<td>time-9*</td>
<td>102</td>
<td>901</td>
<td>1326</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>102</td>
</tr>
<tr>
<td>time-7*</td>
<td>153</td>
<td>1372</td>
<td>1989</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>153</td>
</tr>
<tr>
<td>DS_MAGIC_SUCC_2017-06-22*</td>
<td>1</td>
<td>24</td>
<td>415</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssss*</td>
<td>5</td>
<td>124</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>5</td>
</tr>
<tr>
<td>appoint_abcdefg_msgid*</td>
<td>1</td>
<td>21</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>BUSSINESSXXXXXXX_STATISTICS_NEED_CALC_RECENT*</td>
<td>1</td>
<td>44</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>switch_abcd_abcde*</td>
<td>3</td>
<td>69</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>abcdeferCounter_201*</td>
<td>3</td>
<td>78</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>diy1234567flag*</td>
<td>1</td>
<td>14</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>DS_PRXXBCD_LIST*</td>
<td>1</td>
<td>15</td>
<td>17208</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-4*</td>
<td>133</td>
<td>1194</td>
<td>1729</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>133</td>
</tr>
<tr>
<td>datastatistics_switch_version0*</td>
<td>1</td>
<td>30</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>register_count_2_201*</td>
<td>592</td>
<td>15984</td>
<td>640</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>592</td>
</tr>
<tr>
<td>canVisitNewabcdef1234PageLevels*</td>
<td>1</td>
<td>31</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>YOUR_WEEK_VITALITY_INFO*</td>
<td>1</td>
<td>23</td>
<td>75782</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-8*</td>
<td>101</td>
<td>894</td>
<td>1313</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>101</td>
</tr>
<tr>
<td>EXPERTS_APPOINT_INFO_MAP*</td>
<td>1</td>
<td>24</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-3*</td>
<td>130</td>
<td>1215</td>
<td>1690</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>130</td>
</tr>
<tr>
<td>time-1*</td>
<td>943</td>
<td>9456</td>
<td>12259</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>943</td>
</tr>
<tr>
<td>time-64*</td>
<td>87</td>
<td>781</td>
<td>1131</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>87</td>
</tr>
<tr>
<td>time-5*</td>
<td>168</td>
<td>1516</td>
<td>2184</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>168</td>
</tr>
<tr>
<td>total</td>
<td>4004</td>
<td>53422</td>
<td>7832490</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4004</td>
</tr>
</tbody></table>
<p>string keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>BUSSINESSXXXXXXX_STATISTICS_NEED_CALC_RECENT*</td>
<td>1</td>
<td>44</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-5*</td>
<td>130</td>
<td>1174</td>
<td>1690</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>130</td>
</tr>
<tr>
<td>datastatistics_switch_version0*</td>
<td>1</td>
<td>30</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-7*</td>
<td>39</td>
<td>348</td>
<td>507</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>39</td>
</tr>
<tr>
<td>time-level:*</td>
<td>567</td>
<td>8939</td>
<td>7371</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>567</td>
</tr>
<tr>
<td>diy1234567flag*</td>
<td>1</td>
<td>14</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>switch_abcd_abcde*</td>
<td>3</td>
<td>69</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>time-2*</td>
<td>598</td>
<td>5918</td>
<td>7774</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>598</td>
</tr>
<tr>
<td>time-6*</td>
<td>125</td>
<td>1118</td>
<td>1625</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>125</td>
</tr>
<tr>
<td>time-4*</td>
<td>136</td>
<td>1225</td>
<td>1768</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>136</td>
</tr>
<tr>
<td>time-8*</td>
<td>72</td>
<td>636</td>
<td>936</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>72</td>
</tr>
<tr>
<td>time-1*</td>
<td>1176</td>
<td>11814</td>
<td>15288</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1176</td>
</tr>
<tr>
<td>time-9*</td>
<td>100</td>
<td>880</td>
<td>1300</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>100</td>
</tr>
<tr>
<td>time-root:*</td>
<td>23</td>
<td>272</td>
<td>299</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>23</td>
</tr>
<tr>
<td>register_count_2_201*</td>
<td>592</td>
<td>15984</td>
<td>640</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>592</td>
</tr>
<tr>
<td>DS_AXXXXXXXX_CORRECT*</td>
<td>1</td>
<td>20</td>
<td>20</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>TOP_TEN_NEW_tersssss*</td>
<td>1</td>
<td>20</td>
<td>1529</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>time-3*</td>
<td>202</td>
<td>1925</td>
<td>2626</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>202</td>
</tr>
<tr>
<td>total</td>
<td>3989</td>
<td>53042</td>
<td>46253</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3989</td>
</tr>
</tbody></table>
<p>list keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>XXXXXXXXXXXXXX_STATISTICS_MIGRATION_LIST*</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>DS_MAGIC_SUCC_2017-06-22*</td>
<td>1</td>
<td>24</td>
<td>415</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>DS_PRXXBCD_LIST*</td>
<td>1</td>
<td>15</td>
<td>17208</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>3</td>
<td>79</td>
<td>7710455</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3</td>
</tr>
</tbody></table>
<p>hash keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>tersssss_action_prepage_new*</td>
<td>1</td>
<td>27</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>YOUR_WEEK_VITALITY_INFO*</td>
<td>1</td>
<td>23</td>
<td>75782</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>EXPERTS_APPOINT_INFO_MAP*</td>
<td>1</td>
<td>24</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>abcdeferCounter_2017-06-11*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssssHardTaskCounter*</td>
<td>1</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>abcdeferCounter_2018-04-27*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>abcdeferCounter_2017-09-01*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssssEasyTaskCounter*</td>
<td>1</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>8</td>
<td>198</td>
<td>75782</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>8</td>
</tr>
</tbody></table>
<p>set keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>tersssss_bind_phone_phone*</td>
<td>1</td>
<td>25</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>appoint_abcdefg_msgid*</td>
<td>1</td>
<td>21</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>canVisitNewabcdef1234PageLevels*</td>
<td>1</td>
<td>31</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>tersssss_bind_phone_userid*</td>
<td>1</td>
<td>26</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>4</td>
<td>103</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>4</td>
</tr>
</tbody></table>
<p>zset keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>other keys statistics</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<p>big keys statistics</p>
<table>
<thead>
<tr>
<th>PATTERN</th>
<th>KEY NUM</th>
<th>KEY SIZE</th>
<th>DATA SIZE</th>
<th>EXPIRE IN HOUR</th>
<th>EXPIRE IN DAY</th>
<th>EXPIRE IN WEEK</th>
<th>EXPIRE OUT WEEK</th>
<th>NEVER EXPIRE</th>
</tr>
</thead>
<tbody><tr>
<td>XXXXXXXXXXXXXX_STATISTICS_MIGRATION_LIST*</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>total</td>
<td>1</td>
<td>40</td>
<td>7692832</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<h3 id="作为依赖使用"><a href="#作为依赖使用" class="headerlink" title="作为依赖使用"></a>作为依赖使用</h3><p>获取方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com&#x2F;winjeg&#x2F;rma4go</span><br></pre></td></tr></table></figure>

<p>使用方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">	h := <span class="string">"localhost"</span></span><br><span class="line">	a := <span class="string">""</span></span><br><span class="line">	p := <span class="number">6379</span></span><br><span class="line">	cli := client.BuildRedisClient(client.ConnInfo&#123;</span><br><span class="line">		Host: h,</span><br><span class="line">		Auth: a,</span><br><span class="line">		Port: p,</span><br><span class="line">	&#125;, cmder.GetDb())</span><br><span class="line"></span><br><span class="line">	stat := analyzer.ScanAllKeys(cli)</span><br><span class="line">    <span class="comment">// print in command line</span></span><br><span class="line">	stat.Print()</span><br><span class="line">	<span class="comment">// the object is ready to use</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="github-维护-主要阵地"><a href="#github-维护-主要阵地" class="headerlink" title="github 维护(主要阵地)"></a>github 维护(主要阵地)</h3><ol>
<li>欢迎其他开发者加入</li>
<li>欢迎提issue 反馈问题</li>
<li>欢迎任何有意义的建议</li>
<li>另外欢迎star，不建议fork，建议直接提交PR  ; )</li>
</ol>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2017/12/14/storage/redis/redis_standards/"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59422638-49759700-8e03-11e9-8bdd-dd708ca69e1f.png" alt="redis 使用规范"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-14T07:14:11.000Z" title="2017-12-14T07:14:11.000Z">2017-12-14</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">6 分钟 读完 (大约 844 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/14/storage/redis/redis_standards/">redis 使用规范</a></h1><div class="content"><h2 id="key-value规范"><a href="#key-value规范" class="headerlink" title="key/value规范"></a>key/value规范</h2><ol>
<li>所有的key 应该有合理的业务前缀</li>
<li>key 不应该包含特殊字符，应尽量使用常见的字母，数字， 下划线等组合</li>
<li>key 的大小应该保证在<code>16kb</code> 之内</li>
<li>value 的大小应该保证在<code>1M</code>之内， 拒绝bigkey(防止网卡流量、慢查询)</li>
<li>string类型控制在10KB以内，hash、list、set、zset元素个数不要超过5000。</li>
<li>控制key的生命周期，redis不是垃圾桶, 能过期的key一定要设置过期时间</li>
</ol>
<h2 id="数据类型使用注意"><a href="#数据类型使用注意" class="headerlink" title="数据类型使用注意"></a>数据类型使用注意</h2><ol>
<li>hash 不推荐使用 <code>hkeys</code> 命令除非hash表的尺寸非常小， 否则推荐使用scan</li>
<li>set/zset/list 需要遍历整个列表也尽量使用<code>scan</code>与 <code>lindex</code>等命令</li>
<li>非字符串的bigkey，不要使用del删除，使用hscan、sscan、zscan方式渐进式删除，同时要注意防止bigkey过期时间自动删除问题(例如一个200万的zset设置1小时过期，会触发del操作，造成阻塞，而且该操作不会不出现在慢查询中(latency可查))</li>
<li>选择适合的数据类型, 注意节省内存和性能之间的平衡</li>
</ol>
<h2 id="命令使用"><a href="#命令使用" class="headerlink" title="命令使用"></a>命令使用</h2><ol>
<li>O(N)命令关注N的数量<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如hgetall、lrange、smembers、zrange、sinter等并非不能使用，但是需要明确N的值。有遍历的需求可以使用hscan、sscan、zscan代替。</span><br></pre></td></tr></table></figure></li>
<li>禁用命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">禁止线上使用keys、flushall、flushdb等，通过redis的rename机制禁掉命令，或者使用scan的方式渐进式处理。</span><br></pre></td></tr></table></figure></li>
<li>不推荐使用select,  新业务禁止使用 select</li>
<li>用批量操作提高效率, 但要注意控制一次批量操作的元素个数(例如500以内，实际也和元素字节数有关)。</li>
<li>Redis事务功能较弱，不建议过多使用</li>
<li>必要情况下使用monitor命令时，要注意不要长时间使用</li>
</ol>
<h2 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h2><ol>
<li>避免多个应用使用一个Redis实例, 不相干的业务拆分，公共数据做服务化</li>
<li>使用带有连接池的数据库，可以有效控制连接，同时提高效率</li>
<li>高并发下建议客户端添加熔断功能(例如netflix hystrix)</li>
<li>设置合理的密码</li>
<li>根据自身业务类型，选好maxmemory-policy(最大内存淘汰策略)，设置好过期时间</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">volatile-lru: 即超过最大内存后，在过期键中使用lru算法进行key的剔除，保证不过期数据不被删除，但是可能会出现OOM问题</span><br><span class="line">allkeys-lru：根据LRU算法删除键，不管数据有没有设置超时属性，直到腾出足够空间为止。</span><br><span class="line">allkeys-random：随机删除所有键，直到腾出足够空间为止。</span><br><span class="line">volatile-random:随机删除过期键，直到腾出足够空间为止。</span><br><span class="line">volatile-ttl：根据键值对象的ttl属性，删除最近将要过期数据。如果没有，回退到noeviction策略。</span><br><span class="line">noeviction：不会剔除任何数据，拒绝所有写入操作并返回客户端错误信息&quot;(error) OOM command not allowed when used memory&quot;，此时Redis只响应读操作。</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-12-13T07:14:11.000Z" title="2017-12-13T07:14:11.000Z">2017-12-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">8 分钟 读完 (大约 1205 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/13/storage/redis/monitoring/">redis 简谈redis监控</a></h1><div class="content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>由于redis是一个内存型的数据库，关注的点势必跟MySQL等非内存型的数据库相差比较多， 因此有必要单独对redis的监控关注项进行梳理。<br>此外由于redis的单线程模型， 以及速度要求非常高，因此对于redis的监控需要因事制宜。</p>
<h3 id="监控项"><a href="#监控项" class="headerlink" title="监控项"></a>监控项</h3><h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><p>由于redis是内存型数据库，因此对于内存的需求是最大的需求， 监控项里面最重要的也是对于内存的监控，一般出问题，大概率是内存满掉的问题。<br>一般内存满了之后会导致一系列的问题，比如逐出了不该逐出的key、写不进数据、 超时阻塞等问题。 对于内存的监控是至关重要的。<br>一般一个合理的范围是在 30% 到70%之间。而超过了80%就需要报警和升级了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; info memory</span><br><span class="line"><span class="comment"># Memory</span></span><br><span class="line">used_memory:108476200</span><br><span class="line">used_memory_human:103.45M</span><br><span class="line">used_memory_rss:129523712</span><br><span class="line">used_memory_rss_human:123.52M</span><br><span class="line">used_memory_peak:109672760</span><br><span class="line">used_memory_peak_human:104.59M</span><br><span class="line">total_system_memory:16658898944</span><br><span class="line">total_system_memory_human:15.51G</span><br><span class="line">used_memory_lua:37888</span><br><span class="line">used_memory_lua_human:37.00K</span><br><span class="line">maxmemory:4294967296</span><br><span class="line">maxmemory_human:4.00G</span><br><span class="line">maxmemory_policy:volatile-lru</span><br><span class="line">mem_fragmentation_ratio:1.19</span><br><span class="line">mem_allocator:jemalloc-4.0.3</span><br><span class="line">10.1.9.164:7300&gt;</span><br></pre></td></tr></table></figure>

<h3 id="大Key，-慢查询"><a href="#大Key，-慢查询" class="headerlink" title="大Key， 慢查询"></a>大Key， 慢查询</h3><p>另外一个比较常见的导致线上问题的一大因素是对于redis的不合理的使用，如 大key与慢查询<br>一般而言redis的key与数据越大， 导致的查询时长就越长， 加上redis本身是单线程的模型，因此这类查询往往会影响到其他查询的正常进行， 对大key的控制一方面可以通过中间件或者proxy 等手段来截断或者拒绝， 一方面也是需要使用一定的手段如 redis的 <code>slowlog get</code>命令来查看。<br>有了能获取的方法，那自然就可以对这些东西进行监控并合理的进行报警。 一般来讲redis模型中， 还是以尽量不出现慢查询为宜， 一旦出现慢查询就应该立即报警。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; slowlog get</span><br><span class="line">1) 1) (integer) 155</span><br><span class="line">   2) (integer) 1545025300</span><br><span class="line">   3) (integer) 19422</span><br><span class="line">   4) 1) &quot;COMMAND&quot;</span><br><span class="line">2) 1) (integer) 154</span><br><span class="line">   2) (integer) 1544754674</span><br><span class="line">   3) (integer) 11571</span><br><span class="line">   4) 1) &quot;scan&quot;</span><br><span class="line">      2) &quot;26005&quot;</span><br><span class="line">      3) &quot;MATCH&quot;</span><br><span class="line">      4) &quot;*&quot;</span><br><span class="line">      5) &quot;COUNT&quot;</span><br><span class="line">      6) &quot;10000&quot;</span><br></pre></td></tr></table></figure>

<h3 id="连接数"><a href="#连接数" class="headerlink" title="连接数"></a>连接数</h3><p>redis在与客户端进行通信也是维护了连接的， 这些连接用来处理服务端与redis server之间的命令发送与数据发送等等 另外redis的最大连接数是有上限的 可以通过命令 <code>config get maxclients</code>来取得， 也可以使用<code>info clients</code>来看连接的使用情况，一般而言，连接数只要使用不满其实是不会出现太多的问题的， 但一定用满了，则会导致应用端错误。 因此对于连接数的监控也是以比率为标准比较好， 建议合理的范围是 &lt; 60%, 对于超过80%的情况应给予报警</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info clients</span><br><span class="line">#Clients</span><br><span class="line">connected_clients:621</span><br><span class="line">client_longest_output_list:0</span><br><span class="line">client_biggest_input_buf:0</span><br><span class="line">blocked_clients:0</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET maxclients</span><br><span class="line">    ##1) &quot;maxclients&quot;</span><br><span class="line">    ##2) &quot;10000&quot;</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><p>CPU对于redis来说也是比较重要的需要关注的一个项， 一般跟QPS直接相关， QPS越高，CPU使用的也就越高。<br>对于redis服务来讲， CPU 跟其他服务的要求差别也不大， 不正常区间是 &lt;70% 超过80%则需要报警。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; info cpu</span><br><span class="line"># CPU</span><br><span class="line">used_cpu_sys:88088.66</span><br><span class="line">used_cpu_user:39641.02</span><br><span class="line">used_cpu_sys_children:40.78</span><br><span class="line">used_cpu_user_children:131.68</span><br><span class="line">10.1.9.164:7300&gt;</span><br></pre></td></tr></table></figure>

<h4 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h4><p>QPS 即每秒钟Redis接受的请求数量，不同的Key的大小支持的QPS对于Redis是不同的， 因此单一的对redis的QPS进行监控可能意义不大。<br>如果要做redis QPS的监控应该与历史同期相比较，是否有剧增等情况。 还有一个可以参照点就是经验值， 一般这个配置的redis可以承受多少的QPS。 通过经验值与历史对比两个标准来决定是否需要报警。一般是历史同期的两倍，且比高峰期高的时候，是应该报警的。</p>
<p>QPS 可以通过计算两个时间间隔内执行的总命令数量来计算出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">10.1.9.164:7300&gt; info  stats</span><br><span class="line"># Stats</span><br><span class="line">total_connections_received:215774</span><br><span class="line">total_commands_processed:2980658450</span><br><span class="line">instantaneous_ops_per_sec:50</span><br><span class="line">total_net_input_bytes:1135673367887</span><br><span class="line">total_net_output_bytes:594951090244</span><br><span class="line">instantaneous_input_kbps:30.66</span><br><span class="line">instantaneous_output_kbps:13.65</span><br><span class="line">rejected_connections:0</span><br><span class="line">sync_full:0</span><br><span class="line">sync_partial_ok:0</span><br><span class="line">sync_partial_err:0</span><br><span class="line">expired_keys:161591</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:112552664</span><br><span class="line">keyspace_misses:809125690</span><br><span class="line">pubsub_channels:0</span><br><span class="line">pubsub_patterns:0</span><br><span class="line">latest_fork_usec:3349</span><br><span class="line">migrate_cached_sockets:0</span><br><span class="line">10.1.9.164:7300&gt;</span><br></pre></td></tr></table></figure>

<h4 id="网络IO"><a href="#网络IO" class="headerlink" title="网络IO"></a>网络IO</h4><p>网络IO就是redis在处理命令的时候占用的网络的流入与流出的量， 一般而言， 网络IO是较少关注的一个点， 但在网络达到带宽的上限的时候我们还是应该重视起来， 因为这个时候其他的东西是会阻塞的， 一般推荐的报警值为超过网络带宽的 80%</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-09-13T07:14:11.000Z" title="2017-09-13T07:14:11.000Z">2017-09-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">2 分钟 读完 (大约 308 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/09/13/apps/tidb/">Tidb 笔记</a></h1><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>TIDB是一种分布式高可用实现MySQL协议的可动态扩容的数据库<br>动态扩容是指计算能力与存储空间两个维度的动态扩容<br>tidb 由 tidb server， PDserver 与 TIKV组成<br>基本结构如下图<br><img src="imgs/tidb-architecture.png" alt="TIDB架构"></p>
<h2 id="TIDB"><a href="#TIDB" class="headerlink" title="TIDB"></a>TIDB</h2><p>TIDB 是一个无状态可以动态扩展的服务， 本身并不存储任何数据</p>
<h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h3><ol>
<li>接收SQL请求</li>
<li>处理SQL相关的逻辑</li>
<li>与PD Server 通信定位数据实际存储位置</li>
<li>与TIKV实际交换数据</li>
<li>返回数据</li>
</ol>
<h2 id="PD-server"><a href="#PD-server" class="headerlink" title="PD server"></a>PD server</h2><p>PD Server 负责整个集群信息的管理与通信， 通常要部署奇数台</p>
<h3 id="主要功能-1"><a href="#主要功能-1" class="headerlink" title="主要功能"></a>主要功能</h3><ol>
<li>存储集群数据元信息</li>
<li>管理与负载均衡TIKV， 并负责数据迁移</li>
<li>分配全局唯一单调递增ID</li>
</ol>
<h2 id="TIKV"><a href="#TIKV" class="headerlink" title="TIKV"></a>TIKV</h2><p>TIKV 是一种分布式事务型Key-Value型存储， 它是负责整个TIDB集群所有的实际数据存储的。<br>它使用Raft协议来保证集群数据的一致性与故障恢复，区域是它最基本的存储单元，所有不同节点<br>上的区域副本构成了一个Raft的分组</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-03-18T07:14:11.000Z" title="2017-03-18T07:14:11.000Z">2017-03-18</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">15 分钟 读完 (大约 2250 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/03/18/storage/mysql/roll_back/">Mysql 闪回方案设计</a></h1><div class="content"><h1 id="mysql-数据闪回"><a href="#mysql-数据闪回" class="headerlink" title="mysql 数据闪回"></a>mysql 数据闪回</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>数据闪回属于数据恢复的一个范畴, 常见的数据恢复的方法有很多， 但都大同小异。<br>主要有以下两种方案：</p>
<ol>
<li>进行变更之前把变更前的数据存储下来用于恢复</li>
<li>基于全量备份+ binlog增量备份的方式</li>
</ol>
<p>这两种方案，私下里操作最多的往往是第一种， 因为第一种比较小作坊， 容易操作， 但操作也相对零碎， 人工化， 容易产生失误。第二种是业界许多解决方案的标准， 例如RDS的备份恢复克隆等功能就是按照第二种方案去做的， 但第二种有三个问题， 第一，备份数据比较庞大， 比较多，恢复时间非常久， 第二， 需要有一整套的体系支持（包括不仅限于服务器、运维、等）第三，第二种需要比较大的开发量。需要对binlog 进行订阅解析以及合理的安排， 对备份策略进行合理的程序化定制。</p>
<p>很多企业在发展到一定阶段之后必定会对线上数据变更进行相应的管控， 建立好相应的变更管控的流程。 但这个流程也非万能的， 数据被误操作的概率还是存在， 当数据被误操作后，如何快速恢复到操作前的一个状态， 成了本文主要关注的一个话题。</p>
<h2 id="闪回工具现状"><a href="#闪回工具现状" class="headerlink" title="闪回工具现状"></a>闪回工具现状</h2><h3 id="mysqlbinlog工具配合sed、awk"><a href="#mysqlbinlog工具配合sed、awk" class="headerlink" title="mysqlbinlog工具配合sed、awk"></a>mysqlbinlog工具配合sed、awk</h3><p>该方式先将binlog解析成类SQL的文本，然后使用sed、awk把类SQL文本转换成真正的SQL。</p>
<ul>
<li>优点：当SQL中字段类型比较简单时，可以快速生成需要的SQL，且编程门槛也比较低。</li>
<li>缺点：当SQL中字段类型比较复杂时，尤其是字段中的文本包含HTML代码，用awk、sed等工具时，就需要考虑极其复杂的转义等情况，出错概率很大。</li>
</ul>
<h3 id="给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。"><a href="#给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。" class="headerlink" title="给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。"></a>给数据库源码打patch。该方式扩展了mysqlbinlog的功能，增加Flashback选项。</h3><ul>
<li>优点：复用了MySQL Server层中binlog解析等代码，一旦稳定之后，无须关心复杂的字段类型，且效率较高。</li>
<li>缺点：在修改前，需要对MySQL的复制代码结构和细节需要较深的了解。版本比较敏感，在MySQL 5.6上做的patch，基本不能用于MySQL 5.7的回滚操作。升级困难，因为patch的代码是分布在MySQL的各个文件和函数中，一旦MySQL代码改变，特别是复制层的重构，升级的难度不亚于完全重新写一个。</li>
</ul>
<h3 id="使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。"><a href="#使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。" class="headerlink" title="使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。"></a>使用业界提供的解析binlog的库，然后进行SQL构造，其优秀代表是binlog2sql。</h3><ul>
<li>优点：使用业界成熟的库，因此稳定性较好，且上手难度较低。</li>
<li>缺点：效率往往较低，且实现上受制于binlog库提供的功能。</li>
</ul>
<p>上述几种实现方式，主要是提供的过滤选项较少，比如不能提供基于SQL类型的过滤，需要回滚一个delete语句，导致在回滚时，需要结合awk、sed等工具进行筛选。</p>
<h2 id="开源方案"><a href="#开源方案" class="headerlink" title="开源方案"></a>开源方案</h2><p>总体来讲如下的两种方案其实是一个原理，其中一个程序化了， 产品化了而已。</p>
<h3 id="美团的-MyFlash"><a href="#美团的-MyFlash" class="headerlink" title="美团的 MyFlash"></a>美团的 MyFlash</h3><p>  <a href="https://github.com/Meituan-Dianping/MyFlash">MyFlash</a>  是由美团点评公司技术工程部开发维护的一个回滚DML操作的工具。该工具通过解析v4版本的binlog，完成回滚操作。相对已有的回滚工具，其增加了更多的过滤选项，让回滚更加容易。</p>
<ol>
<li>无需把binlog解析成文本，再进行转换。</li>
<li>提供原生的基于库、表、SQL类型、位置、时间等多种过滤方式。</li>
<li>支持MySQL多个版本。</li>
<li>对于数据库的代码重构不敏感，利于升级。</li>
<li>自主掌控binlog解析，提供尽可能灵活的方式。</li>
</ol>
<h2 id="闪回工具分析"><a href="#闪回工具分析" class="headerlink" title="闪回工具分析"></a>闪回工具分析</h2><p> 以上业界的一些闪回方案，基本上都是基于Binlog 去倒腾的， 有一些明显的限制</p>
<ol>
<li>不能针对某条语句(tansaction)进行回滚操作</li>
<li>需要维护binlog, 建立binlog 相关的逻辑体系</li>
<li>人工变更与应用变更不能真正分开(闪回是针对某个表， 某个类型，在某一段时间内的全部数据)</li>
<li>使用起来不方便， 对于普通研发来说成本还是蛮高的</li>
<li>…</li>
</ol>
<h2 id="闪回工具的方案"><a href="#闪回工具的方案" class="headerlink" title="闪回工具的方案"></a>闪回工具的方案</h2><p>为了解决以上所有问题， 主要考虑以下两种方案（两种都是原创）</p>
<h3 id="基于SQL重写与备份的方案"><a href="#基于SQL重写与备份的方案" class="headerlink" title="基于SQL重写与备份的方案"></a>基于SQL重写与备份的方案</h3><p>这种方案的整个大的流程如下：</p>
<p><img src="https://qhyxpicoss.kujiale.com/2019/04/24/LS75DLYKAQBZMRS4AAAAABQ8_768x189.png" alt="AST"></p>
<ol>
<li>变更前备份： 在实际执行语句前，通过对SQL语句的重写，来达到保存变更前状态的一个目的。</li>
<li>变更执行： 进行实际的变更操作</li>
<li>备份恢复： 利用备份的数据进行恢复（一般是自动生成rollback的SQL语句进行执行）</li>
</ol>
<p>上述环节中， 最重的一部分工作就是变更前的备份，其中工作量最大的一部分就是进行SQL的重写，这有可能涉及到AST语法树的部分， 当然对于比较简单的SQL语句， 也用不着AST语法树。<br>这里面最大的工作量就是SQL语句的重写， 利用重写的SQL进行原数据查询， 再将变更前的数据备份下来。</p>
<p>整体的一个流程如下：</p>
<p><img src="https://qhyxpicoss.kujiale.com/2019/04/24/LS75X3QKAQBZOUT4AAAAAAQ8_1125x181.png" alt="ast"></p>
<p>存在的问题： 备份与实际写入之间是存在时间间隔的， 如果这个时间间隔内存在其他变数，则也只能恢复到备份的时候的状态。</p>
<h3 id="基于binlog-映射SQL语句的方案"><a href="#基于binlog-映射SQL语句的方案" class="headerlink" title="基于binlog 映射SQL语句的方案"></a>基于binlog 映射SQL语句的方案</h3><p>对于每一个DML操作， binlog 总是忠实的记录了DML操作的详情，我们可以利用这个详情用于事后恢复数据。<br>但binlog 并未将语句与binlog一一对应起来， 如果要做，可能需要花费的代价比较大，浪费很多的存储空间。<br>由于我们的需求是仅对我们的变更进行回滚，不对其他同类型同时间的变更进行回滚， 所以，我们需要有能力将binlog与我们的变更进行一一对应。<br>整体的操作流程如下：</p>
<p><img src="https://qhyxpicoss.kujiale.com/2019/04/24/LS74QSYKAQBZOUT4AAAAADQ8_749x192.png" alt="binlog"></p>
<p>从图中可以看到， 变更的执行跟数据的备份恢复其实是分开的， 变更执行只是变更执行，不用去卡很多时间点相关的概念， 也不同担心备份的跟实际变更的数据会不一致。<br>避免了上面方案的一个时间差的问题，而且不需要进行SQL语句的重写与反查数据库。</p>
<p>为了能做变更与binlog 的唯一对应， 我们需要对变更执行这个步骤做一些手脚， 加入一个唯一对应的标志。<br>由于binlog 是会忠实记录变更的， 因此我们可以给每个变更生成一个唯一标志， 并把这个唯一标志体现在binlog 里面， 这样我们就实现了变更与binlog的对应。<br>有了这层对应关系我们就可以轻松的对这个变更进行数据的恢复， 从而不影响其他同时间同类型的变更。</p>
<p>数据备份模块也是需要投入开发的一个模块他主要涉及到以下工作：<br>0. binlog 名称与位点的确定</p>
<ol>
<li>slave 伪装</li>
<li>binlog 接收与解析</li>
<li>定位变更的binlog</li>
<li>由对应的binlog生成相应的备份</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>就开发量上来讲， 两种方案都是差不多的， 整个周期至少都需要2-3周左右的开发量，<br>我们显然应该采取第二种方案， 因为第二种方案与业界许多方案有比较多的共通之处， 也是比较通用靠谱的一种方案， 而且避免了查询间隔带来的数据不一致问题。<br>而且它与现有生态融合比较好。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-08-13T07:14:11.000Z" title="2016-08-13T07:14:11.000Z">2016-08-13</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">8 分钟 读完 (大约 1211 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/08/13/storage/mysql/alert/">简谈MySQL报警</a></h1><div class="content"><h2 id="报警"><a href="#报警" class="headerlink" title="报警"></a>报警</h2><p>报警时我们保证稳定性的最后一道坎， 如果进入了报警的阶段，应用离Down掉就不远了。 报警也是我们保障稳定性的一个重要的环节。<br>对于报警的设置是比较考究的， 下面主要会分析一下报警的几个方面。</p>
<h3 id="报警的及时性-★★★★★"><a href="#报警的及时性-★★★★★" class="headerlink" title="报警的及时性 ★★★★★"></a>报警的及时性 ★★★★★</h3><p>对于报警，笔者认为最应该优先保障的就是及时性， 试想一个应用已经被用户反馈挂了的情况下， 这个时候就算不用报警，开发者应该也已经知道了。 这个时候报警存在的意义就是0了。因此报警最重要的一个特性就是要能及时地反馈问题，让应用开发者能够在用户发现之前发现问题，处理问题和解决问题。</p>
<h3 id="报警的准确性-★★★★☆"><a href="#报警的准确性-★★★★☆" class="headerlink" title="报警的准确性 ★★★★☆"></a>报警的准确性 ★★★★☆</h3><p>很多人会碰到收到的报警太多的情况， 也有很多人会碰到收不到报警的情况。这两种情况基本上来讲都是不太正常的， 当然不排除后者是在应用非常良好的情况下，有一堆其他措施能够保证不需要走到报警这个环节。对于过多的报警，很多人往往容易麻木， 这样就容易造成人们心理的一种懈怠， 反正之前报警什么事情也不会发生， 现在报警应该也不会发生什么事情，一旦到了关键时候，警也报了，但没有相应的人员去处理，最终酿成应用挂掉影响用户的惨剧。 所以报警不光是要能及时， 也要能准确， 能够区分报警的优先级别，用不同的方式来警告开发者， 并正确反馈情况。</p>
<h3 id="报警的渠道和高可用-★★★★☆"><a href="#报警的渠道和高可用-★★★★☆" class="headerlink" title="报警的渠道和高可用 ★★★★☆"></a>报警的渠道和高可用 ★★★★☆</h3><p>说到报警的高可用， 除了报警服务本身的架构之外，本文更关注的是多渠道。<br>因为任何渠道都有阻塞或者down掉的可能性， 而且不同的渠道的触达及时性不同。<br>一般而言，电话报警的触达及时性是最高的，有电话大家往往能够及时看到。 其次，短信也是一个报警经常选择的手段， 因为短信也是会在比较短的时间内可以被开发者察觉到， 而且手机是随身携带的，不管在上班还是下班都能相对及时的收到。第三开发者往往会使用一些聊天软件如企业微信与钉钉， 这些软件在开发者使用电脑的时候可以比较及时的收到，因为性格不同， 一般开发者下班不太会关注这类软件的通知与消息，因此这类软件的有效性只能排到第三。最后一个也是一个很常见的手段：邮件。 邮件对于大家来说都不陌生， 但邮件的实时性一般会比较差一点， 但邮件有一个好处：可以沉淀比较多的内容，一起发送。</p>
<p>不同的渠道的作用与及时性也不一样，一般报警会选择多渠道结合， 科学合理的利用与选择这些渠道。</p>
<h3 id="报警的科学性与智能性-★★★☆☆"><a href="#报警的科学性与智能性-★★★☆☆" class="headerlink" title="报警的科学性与智能性 ★★★☆☆"></a>报警的科学性与智能性 ★★★☆☆</h3><p>最后一点也是不太好做的一点， 但一旦做好就会让人感觉比较舒服。试想一下，利用机器学习的方式，回顾监控需要关注的各个指标，以及当时的处理情况，通过与往期数据的结合分析， 最终做出决定是否要报警。 这类服务一般的研发成本也比较高， 但它确实可以让人感觉比较有用，比较舒服。 如果做的好， 可以在各项指标都还正常的情况下，会更早的报警，更早的反馈问题， 可以留给开发者更多的时间处理问题，这在极大程度上能减少损失；另外这类报警一般也可以比较人性化一点： 比如可以根据报警的优先级以及时间段决定是否去烦扰正在熟睡中的开发者。<br>总之这个领域可以做的比较多，但做的好往往会要求比较高的投入与比较精致的设计。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-07-14T07:14:11.000Z" title="2016-07-14T07:14:11.000Z">2016-07-14</time><span class="level-item"><a class="link-muted" href="/categories/storage/">storage</a><span> / </span><a class="link-muted" href="/categories/storage/database/">database</a></span><span class="level-item">3 分钟 读完 (大约 486 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/14/storage/mysql/clients/">常见的MySQL客户端</a></h1><div class="content"><h2 id="驱动-程序连接"><a href="#驱动-程序连接" class="headerlink" title="驱动/程序连接"></a>驱动/程序连接</h2><h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><p>如果你是maven项目，则只需要引入以下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果不是， 可以下载Jar包直接使用</p>
<h3 id="go"><a href="#go" class="headerlink" title="go"></a>go</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/go-sql-driver/mysql</span><br></pre></td></tr></table></figure>
<p>对于go项目直接引入依赖即可</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>由于作者我不熟悉其他语言， 不在此赘述其他语言的客户端驱动是怎么样的，但是对于大部分语言来说都有比较知名的驱动。</p>
<p>##桌面客户端</p>
<h3 id="MySQL-Workbench-Official"><a href="#MySQL-Workbench-Official" class="headerlink" title="MySQL Workbench (Official)"></a>MySQL Workbench (Official)</h3><p>MySQL 是官方的MySQL客户端，它是开源免费的，有开源社区跟Oracle的支持，功能也是比较的完善，易用性比Navicat 稍差，功能比较强大，它自带了非常多的功能，比如数据迁移，可视化Explain， Dashboard, 及常见的查询， schema 设计等等。本文将以次工具来展示MySQL的许多功能</p>
<h3 id="Navicat-for-MySQL"><a href="#Navicat-for-MySQL" class="headerlink" title="Navicat for MySQL"></a>Navicat for MySQL</h3><p>Navicat是一款商业软件，其功能是非常的强大，UI与易用性也是屈指可数的，是一个被广泛盗版的软件</p>
<h3 id="PhpMyAdmin"><a href="#PhpMyAdmin" class="headerlink" title="PhpMyAdmin"></a>PhpMyAdmin</h3><p>一个基于Web的SQL客户端</p>
<h3 id="DBForge-Studio"><a href="#DBForge-Studio" class="headerlink" title="DBForge Studio"></a>DBForge Studio</h3><p>它是一个商业软件，目前存在免费版跟收费版本，收费版本功能更多一些，界面跟以前的某些版本的Visual Studio类似，功能应该也比较强大 </p>
<h3 id="HeidiSQL"><a href="#HeidiSQL" class="headerlink" title="HeidiSQL"></a>HeidiSQL</h3><p>使用Pascal写的一个SQL客户端工具，它有着非常强大的功能跟非常垃圾的用户使用体验。</p>
<h3 id="Sequel-Pro"><a href="#Sequel-Pro" class="headerlink" title="Sequel Pro"></a>Sequel Pro</h3><p>Mac下的一个MySQL 客户端， 列出来只是给Mac用户多一个选择。</p>
<h3 id="Eclipse与Idea-插件"><a href="#Eclipse与Idea-插件" class="headerlink" title="Eclipse与Idea 插件"></a>Eclipse与Idea 插件</h3><p>这个是与自己的开发环境IDE集成的一种MySQL工具， 它往往提供的功能比较简单，通常包括语句查询、Schema建立与删除、自动补全等功能。</p>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/categories/storage/database/page/0/">上一页</a></div><div class="pagination-next"><a href="/categories/storage/database/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/categories/storage/database/">1</a></li><li><a class="pagination-link" href="/categories/storage/database/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="节哥(winjeg)"></figure><p class="title is-size-4 is-block line-height-inherit">节哥(winjeg)</p><p class="is-size-6 is-block">软件工程师</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·杭州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">72</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">44</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/winjeg" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/winjeg"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com/winjeg"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/winjeg"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="mailto://winjeg@qq.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/application/"><span class="level-start"><span class="level-item">application</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/base/"><span class="level-start"><span class="level-item">base</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/biz/"><span class="level-start"><span class="level-item">biz</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/container/"><span class="level-start"><span class="level-item">container</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/container/docker/"><span class="level-start"><span class="level-item">docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/container/k8s/"><span class="level-start"><span class="level-item">k8s</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/devops/"><span class="level-start"><span class="level-item">devops</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/gramma/"><span class="level-start"><span class="level-item">gramma</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/lang/"><span class="level-start"><span class="level-item">lang</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/os/"><span class="level-start"><span class="level-item">os</span></span><span class="level-end"><span class="level-item tag">16</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/os/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/other/"><span class="level-start"><span class="level-item">other</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/"><span class="level-start"><span class="level-item">storage</span></span><span class="level-end"><span class="level-item tag">26</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/storage/bigtable/"><span class="level-start"><span class="level-item">bigtable</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/database/"><span class="level-start"><span class="level-item">database</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/etcd/"><span class="level-start"><span class="level-item">etcd</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/middleware/"><span class="level-start"><span class="level-item">middleware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/mongodb/"><span class="level-start"><span class="level-item">mongodb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/redis/"><span class="level-start"><span class="level-item">redis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/storage/rocksdb/"><span class="level-start"><span class="level-item">rocksdb</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://www.zhihu.com/people/winjeg-84/posts" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">知乎</span></span><span class="level-right"><span class="level-item tag">www.zhihu.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://juejin.cn/user/2277843824033486" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://my.oschina.net/u/3673481" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">开源中国</span></span><span class="level-right"><span class="level-item tag">my.oschina.net</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://blog.csdn.net/winjeg" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><a class="media-left" href="/2021/11/10/devops/chaos/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/141085815-0ce4b689-c754-4c42-bc68-183060bddf6c.png" alt="混沌工程"></p></a><div class="media-content size-small"><p><time dateTime="2021-11-10T07:14:11.000Z">2021-11-10</time></p><p class="title is-6"><a class="link-muted" href="/2021/11/10/devops/chaos/">混沌工程</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/devops/">devops</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-11-10T06:33:18.837Z">2021-11-10</time></p><p class="title is-6"><a class="link-muted" href="/2021/11/10/others/wifi_display/">others/wifi_display</a></p><p class="is-uppercase"></p></div></article><article class="media"><a class="media-left" href="/2020/10/23/base/jwt/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/96998573-3f6eb700-1566-11eb-8c16-ca031f895b69.png" alt="JWT 基本原理笔记"></p></a><div class="media-content size-small"><p><time dateTime="2020-10-23T11:14:11.000Z">2020-10-23</time></p><p class="title is-6"><a class="link-muted" href="/2020/10/23/base/jwt/">JWT 基本原理笔记</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/base/">base</a></p></div></article><article class="media"><a class="media-left" href="/2020/09/14/apps/git_recommend/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/59480122-fb5ba480-8e91-11e9-9c26-7f8d6d97868a.png" alt="Git提交规范"></p></a><div class="media-content size-small"><p><time dateTime="2020-09-14T14:14:11.000Z">2020-09-14</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/14/apps/git_recommend/">Git提交规范</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/tools/">tools</a></p></div></article><article class="media"><a class="media-left" href="/2020/07/04/others/shuangpin/"><p class="image is-64x64"><img class="thumbnail" src="https://user-images.githubusercontent.com/7270177/86505485-da952280-bdf7-11ea-84b7-26e732485417.png" alt="输入法之双拼"></p></a><div class="media-content size-small"><p><time dateTime="2020-07-04T02:14:11.000Z">2020-07-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/04/others/shuangpin/">输入法之双拼</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/tools/">tools</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/antd/"><span class="tag">antd</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/base/"><span class="tag">base</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bigtable/"><span class="tag">bigtable</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/biz/"><span class="tag">biz</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/chaos/"><span class="tag">chaos</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cicd/"><span class="tag">cicd</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/container/"><span class="tag">container</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/database/"><span class="tag">database</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/devops/"><span class="tag">devops</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ftp/"><span class="tag">ftp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gramma/"><span class="tag">gramma</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/input/"><span class="tag">input</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/json/"><span class="tag">json</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jwt/"><span class="tag">jwt</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lang/"><span class="tag">lang</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ldap/"><span class="tag">ldap</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/multi-media/"><span class="tag">multi-media</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/notes/"><span class="tag">notes</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/npm/"><span class="tag">npm</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openapi/"><span class="tag">openapi</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/project/"><span class="tag">project</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/react/"><span class="tag">react</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rocksdb/"><span class="tag">rocksdb</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/standards/"><span class="tag">standards</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tidb/"><span class="tag">tidb</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tidis/"><span class="tag">tidis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tutorial/"><span class="tag">tutorial</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yaml/"><span class="tag">yaml</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%B4%A2%E5%BC%95/"><span class="tag">索引</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="节哥的博客" height="28"></a><p class="size-small"><span>&copy; 2021 winjeg</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Follow me on github" href="https://github.com/winjeg"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://winjeg.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>